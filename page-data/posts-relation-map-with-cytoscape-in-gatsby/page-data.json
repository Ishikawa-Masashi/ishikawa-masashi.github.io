{"componentChunkName":"component---src-templates-blog-post-template-tsx","path":"/posts-relation-map-with-cytoscape-in-gatsby/","result":{"data":{"post":{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p><a href=\"https://takumon.com/gatsby-related-posts-like-hugo\">以前の記事</a>で紹介した<strong>タグとキーワードから関連記事を算出するロジック</strong>と、<a href=\"http://js.cytoscape.org/\"><strong>Cytoscape.js</strong></a>を用いて記事の関連情報を視覚的に確認できるマップを作りました。\n今回はそのマップの紹介とCytoscape.jsを使ってみた感想です。</p>\n<h2 id=\"記事関連マップ\" style=\"position:relative;\"><a href=\"#%E8%A8%98%E4%BA%8B%E9%96%A2%E9%80%A3%E3%83%9E%E3%83%83%E3%83%97\" aria-label=\"記事関連マップ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>記事関連マップ</h2>\n<h3 id=\"使い方\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\" aria-label=\"使い方 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使い方</h3>\n<p>URL: <a href=\"https://takumon.com/map\">https://takumon.com/map</a> <br/>\n遷移方法: 一覧ページのCytoscapleアイコンから遷移できます。 <br/>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABcRAAAXEQHKJvM/AAAFGElEQVR42o1Pa0xTBxi9peUpUMFH5sLYpjiVcmmB9vZdiijqFuOC8zk1LGZK5tSg2YbB13RDMonLfsjmjI44jczJ4rAwFVHLvUEUBbtJ0Upb+qJX6AN8TfDengUWfyz7sX3Jl/Od833fSQ5RmJxxcNHEzMtLxXMaVoklpo3JElOpWGLaJJaYtiVKTBXxpGm/iDRVRWWbqqNJU7WINNWIZKZvRTLTcYHMdIrINp0kpA31RE7z8WhJNbE8haQ3TJJjS2oOtzMlD1XJChxIlqMqWY6aBAWOxVGojaLws4DC2RgKTTFKNItUuBilAiNUo12gxk2RmnMmGsAkUwxRIpaYt6fmYseErNFdSVJ+pziHP5CYyx9OkPMnYim+Nl7BnxAp+DNRFF8fQ/EN0XK+SZjLX42V822JKv52qobvnKwZdbyiQ9urilaiVJxF707JQ3W6kTuYqkRVLImaaCmOCUmcjspCHZGFeiILJoLEJYKEOZ7CjSn5uJWixq14GSyJObBOVnCBmfmwZFAMsV1M0pVxMtQVb+bMZV/BvGEf2jZ+gQuG9bi+rgIdJXvQtaoClqWf4u77O9GZ8TbYI2fg2nIA3q1fwle6C+yyjdyT2Wp0k2qGKE+S0ofi83A0rYC7uq4C9LpdaFtZjo4V5bizfAc6526CtWQvelaXw7ZsG/54ayG8H+2Fd3UZBsr2YehgDYY++5wbyaTwgNIwxO4Ekv4uVoHvBVLuOEHipECCs4IsNAiyxyO2ENkwC0m0x0nRGZcN6yQKtqlyuNIU8KTnIaguQFhr5GDMh6dIyRCV8ST9g1COH2XzudO6RWgWF6AlWQ9abMSNKXNxO60Qv79eCOuMeXCQRXBJF8IzJx/+TC3CSgOe6LV4pNVwKDbCv4RiiK+iSbo+WosmjY67UKBG3WQ96jLW4td3StCmWYCe9PnombUA9swi+HKL4FcuQkBRgJBch6dGPZ4vMGBksY7DBwb0v0cxxGGhlG4gKPwSp+AuJqjQJMrDpaR8tKYZYElXwzZVCcdrKjhnaOGbpYV/jgZDSj2eFRkwulgPboke/BoNhw8N8JfkMkQtIaObCRXOEXKuWahA+wQVuiZSuDdFBds0Nexv6uCZqcXTbAqDinw8KTCAm6cDP2a0VA9+pQ58qYpDhRL+8tkMcUKQQ18VanA5Rsm1TVDhdooa1mla9L6hg2uWDg8lOrDqQtS/W4bKNYdwZH0lPIsL0b5kPh6uNQJlFPhPFByqcsHun8EQdcRsukMgw3UByXXGSnE3KQf3UnLgSstDf4YcjyW5cKuNUG82Q7r1Joo+bsap4mL8lD8dv61QIbhHgp5vMjm2cjrcXyczRE/tOXq0pQNB0zVuuNGMxxfMeHrJjOdXWjF6rRU83Yo/GQZOywM0XOyB+cpd+FrO41rtUfSaGxFxtuBZXzOHQRr9d04xxMDAAA0AkUiEw38UH4kgEvm3/vKXZVmG6LM7aHA8ggOD3FAwiNDgIEKBAMLBIAIDA3gUDiMcCGAwEEQoFEYoFMJQOIShUBD9Xi/6nPYxPm7o93sZwmazmVmWhd1uH7XZbHxvby9vtVp5h8MxPns8Hr6/v5+39/by9+/f5/v6+ni32z2u2+123mKx8CzLjv5t6G8lnE4nPTIyguHhYc7n86G7uxtjGA6H8eLFC/yf+kdkS1dXtdfrbXG73ed9Pl+j2+0eb5fLNY5er7dxTH+5G+MvbxwOxzj3eDznWZZtsVgs1X8B0vHYp0ITHXQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/36e93537aed54f83c2013f263fd14f34/ba381/map-link.webp 200w,\n/static/36e93537aed54f83c2013f263fd14f34/7f61c/map-link.webp 400w,\n/static/36e93537aed54f83c2013f263fd14f34/d00b9/map-link.webp 800w,\n/static/36e93537aed54f83c2013f263fd14f34/92f8c/map-link.webp 1200w,\n/static/36e93537aed54f83c2013f263fd14f34/972ad/map-link.webp 1243w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/36e93537aed54f83c2013f263fd14f34/772e8/map-link.png 200w,\n/static/36e93537aed54f83c2013f263fd14f34/e17e5/map-link.png 400w,\n/static/36e93537aed54f83c2013f263fd14f34/5a190/map-link.png 800w,\n/static/36e93537aed54f83c2013f263fd14f34/c1b63/map-link.png 1200w,\n/static/36e93537aed54f83c2013f263fd14f34/d93d9/map-link.png 1243w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/36e93537aed54f83c2013f263fd14f34/5a190/map-link.png\"\n            alt=\"map link\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n<br/></p>\n<p>記事のサムネイル画像が、タグ・キーワードの関連線でつながっています。\n記事はドラッグ＆ドロップでグリグリ動かせます。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2995f4a8b9801cc29498d1ff635a4640/0d6fe/map.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACyUlEQVR42mWSS2+rRhiG+f9ddNdFF91Uqqoue5N6HDWRzqWnJ8fHThzHjrEHxuZiGxhgLmCYGd6KSdIu+mkQIwYenu/iLRaLn8qyPDPGAs45LcuSZllGV4sN3fkBDYKQ3n+5p4v5gjLGqJSS8ralQggqpKSibWld14GUMvN9/wcvDMMbADDG2PHOK4GmadxVZAxCCJzPHMWpG4/RSIn48QGdNqizE5L5LSxgxrMkSa68fRxft0UGMp9qAHaMOEpsGAZ2OX2yUZzZ8PffrFh+GH9oVVVa+vd7y+rapnFsz1vfWqB/Ab7xaBTdoJFgZGcGAMMwII4TFKxAXmQIggjF7DOGausMVdPizAXC+RSbj+8ge42u65xhmqYT7+HhwaWMF+0ROEZMItx/uMOXd0s0lx4DBvTGYvX2GuvZFEkUgW59HMgO6+s3z8AkmXhX33x90ymJVilzXC/R984e1amCLLjbd10H/xCDNy1UGoNlGR4//YXN/R0ubQt+TP4z3K5XzlDWlUnvpv8CXXpKQUqJXms0vXb2YwJjMeWBoi3y5xeHwQHXs9nE2+52r112D0fgYZviojq8v51in5zcNySk8IPwFYCqaVByjkYp9P1zDVe3HyfezXdfOSDLuImCFFVV4XwoYM0wthxaa8fgQkAqhba9QEqFNM+RHFOcGEOSn57HZkx5t/7sgFUhTH4qwXmNpm2g+x5BEEBJieX6CY9PGwd++2kBn1D03QWNkhBjSYx9ncOJR/f0T2fA677tWlPkzMzv5qYsK/PzL7+aLMtMzpg554V5qYyRUpo4ORp6SA0rjmY/+7YDJNJj9odHD/TZsKqtG5lxWfwvtHYSePT3WG0I4jTDehsBQ4+2XLwYnq68zWbz49jxruu2WmsipCDHY0KUUqTrOtL3PeFCkNXGJ4JzkhcVYRUn1hgCa4nWhmiLrTb2uN/vv/8HGunK7Poy11AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2995f4a8b9801cc29498d1ff635a4640/ba381/map.webp 200w,\n/static/2995f4a8b9801cc29498d1ff635a4640/7f61c/map.webp 400w,\n/static/2995f4a8b9801cc29498d1ff635a4640/d00b9/map.webp 800w,\n/static/2995f4a8b9801cc29498d1ff635a4640/177a2/map.webp 1115w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2995f4a8b9801cc29498d1ff635a4640/772e8/map.png 200w,\n/static/2995f4a8b9801cc29498d1ff635a4640/e17e5/map.png 400w,\n/static/2995f4a8b9801cc29498d1ff635a4640/5a190/map.png 800w,\n/static/2995f4a8b9801cc29498d1ff635a4640/0d6fe/map.png 1115w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2995f4a8b9801cc29498d1ff635a4640/5a190/map.png\"\n            alt=\"map\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>関連線はタグよりもキーワードのほうが太くなっています。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/077b7/map-relation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACiUlEQVR42nVSTW/TQBD1qaKHCtRLq6IiVdyK+AmtCmrFv+HCgROHHvgjICGEBKeinsFCbSpL0Hw0cT68dmyvnTj+2KwTx7U3g2aVFIroSM8rz86+fW9mFV3XP7muW/N9/4IQohmGofm+r1FKtTAM5drr9bRut6u1Wi0tiiKZcxxHGwwGWhAEWhzHF4yxarvd/qJQSmue74Nt28K2bej3+6DrOpyfVyCKIsCYz+c3a1GUEgBzmE6nEIYhbgn8jEajpqKq6uXh4SHs7+0Vzw4OxPP9ffHi6EicnZ2JKIrEovgGcRxL5HkuwRjDfIGEw+HwSjk5Oamtr63Bg9VVcW9lBfbW78PTh1vQIQSu8xwmk4lUjWpd1wVCCFiWBWVZghACZrPZbYWnp6e1R9vbsLW5KTY2NuDxzg482d2FTqcDnHNpC4kMwwBKKXS7XTBNApVKBarV6vICgXvtdrup4EA8z8Mf0ev1oF6vA66oIE1TyPMcHMeRpOPxGCaTFHS9DS9fvQZi2ZByjnVSoed5TSWKoprUjPoXkWUZFEUh7WAawRiDJEmgKK7B7Dvws9aUedt2Ictm8uxgMGgqo9FIEhZFIVAVRhAEEMexVIlAcrS+vBNzOHFsCSrnnP8h/J9CLB4zhk2WoK4LnkfBNE35pNABAtuBLrIsE4sp3yZcvjd8l2+O30K13gDHscEgBhCTQKNxJfv5byzFyCmHYfhrkbwWQqDnklh2+f7j5zJOWDlmvLz8+qNMg0TuIbBuPp/fAM8uWtW40zL2jfMUyqIEWjdgxqdwVyzPDofDlmJZ1rvpdFrhnH/jnKuIJElU0zRVkxDVo1TtU1t1KFVZkqjLmr/BGPuepmnFMIwPvwEiUah8U8wqCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/ba381/map-relation.webp 200w,\n/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/7f61c/map-relation.webp 400w,\n/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/d00b9/map-relation.webp 800w,\n/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/308c4/map-relation.webp 1166w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/772e8/map-relation.png 200w,\n/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/e17e5/map-relation.png 400w,\n/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/5a190/map-relation.png 800w,\n/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/077b7/map-relation.png 1166w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c1ba0a4d1bff6ff82cfa78e9e4dc8448/5a190/map-relation.png\"\n            alt=\"map relation\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>記事にマウスカーソルを合わせると拡大され、関連線が青にハイライトされたり...\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e4b0732aafdfa3d7775f8a48053c922a/99f37/hover-style.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACrklEQVR42nWT2Y7TMBSG5+14Fy6QuOIVYC54BSS4YDSIRUiDkAAxQ1hC6WS6t9O007RpO6mbzXHabLZ/5KQFJFRLx1bOsT/9/4l9RCm98n3/u+/7uoowDPUoinTGIj0ttvp2G+tBEOqMMT2OY30ymehG09Brtbp+8uxMP3v5SW80G99Go1HHMIx7RwAghBDYjSRJwOIIEWWwhrdY2gRpmsDzPIRBWO7p6B3cThzMPtmYtlYqxdU0HA6P98BCLSpCn4rFbC58NxA/3nfFsDUTQRiIbrcn7NlcCBTi/NWleP/0pzBOe2JYs9W5XHFM03z4V6GsFG7YFk3tGoNLGzftW3hOVKpbLJbwPBeuW2A5z2DfrDCbEHgk+qPQNM1H/1mWEBg016ifz1D/PCht7ytxDLguICXKNgjBq4qUh4FpKuH5EvtMlqXYblMEgQQhVTLPc1iWhTTNDgPlzvJyWWA0SiG4VBvBOdBqBbi8dEHpttxTFBztdhtBEGB3/rBCy8qwXOa7g4Dvq1yOXs+E65I9AI7jgPMDljmvgGperSTyvIJ5HkDp3noGxmJsNhtENAJZEfihi5B5IGtSAq+vryvgzJ6JxWKBycTCdEqRJAUcJwOlHH9+ltyDE3S7HVw1rvDtwxUu3jZg3UxVgyogXTMYXxpCKVAW1JpmGeK4UqNAeS7BGEeSSBQCGLctTIdTPG8f48mHx5DpP9em9bWL+3ce5IP+mNebHd7tm9zsTTghLve8lLuu5ONxxvv9hM/nOQ9CcHvs8I+ndX7y4iV/8/od39As21l+eLQNEwx/jURAGQYjC4R48JYB8jQv1e57q5Tube+uZTVUTci/T49GtOaF7gUhjub7rrZekzJs29ZULo6ZFse0DEqpFoZUY4xpm02ssSTU4qT8vqCUGoZh3P0NHwYR9lvHM1IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e4b0732aafdfa3d7775f8a48053c922a/ba381/hover-style.webp 200w,\n/static/e4b0732aafdfa3d7775f8a48053c922a/7f61c/hover-style.webp 400w,\n/static/e4b0732aafdfa3d7775f8a48053c922a/d00b9/hover-style.webp 800w,\n/static/e4b0732aafdfa3d7775f8a48053c922a/abb12/hover-style.webp 1100w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e4b0732aafdfa3d7775f8a48053c922a/772e8/hover-style.png 200w,\n/static/e4b0732aafdfa3d7775f8a48053c922a/e17e5/hover-style.png 400w,\n/static/e4b0732aafdfa3d7775f8a48053c922a/5a190/hover-style.png 800w,\n/static/e4b0732aafdfa3d7775f8a48053c922a/99f37/hover-style.png 1100w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e4b0732aafdfa3d7775f8a48053c922a/5a190/hover-style.png\"\n            alt=\"hover style\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<br/></p>\n<p>記事関連マップをフルスクリーン表示できたり...\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0af55a5e63de5f54c811557f40cd4c13/29007/fullscreen-button.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAACBElEQVR42o2Sz05TQRTG+5I+gg/gzo1o4ku40p2JJsYFG4zEhKjUZgRKuTQFWurtbQsUWnrn/58z85k7gAvjwkm+nDlnMr858820jo/7w8Fg0FssFgXnspBSZSmlCiWb/L/U01oPR6PR2xYAeO8iESHFRgExRoQQ4L1HSimrqf09v9uTY2w4FxcX7db1UqCsLqmaXSbWv0rfuvNUc5mM0Ukpnbz3KRClEEKOTQ4g59bau/UQqAHO5/PdVrc4xdb2Tuz87OHpqy4ePe9gPBfwwYLXAtZYCCGwWi1z1FrjxcYGPn/aahiw1kJwmTucTCbt1vvNbTx+8iwKZSA0QdsApAQpFZRSGTA6L3F2XkFKCWMt9vf2mutlIF8LDA7GGVhOynb2sPGg5hpSGkQizGYzTKczcM7hrIVzHj4QptUEi6ur7F2MhLoW9wfrDJxOp/fAiFh0XqJ/8BqeAGdNvuq6rnE6HILXPHejJc9ruZtfJbrFQbZFShmd8RieDB86jN6YNTknqHm8BxnnaLWuiQJRYzxRbMzPMsrRzWJFWmvSRnu+UhgUJ98zMMYYg7WId4/1z6F9wKJew/sAY1yuSa4guPjzbcqy/NEiop501Dn8+I6dtr8yE4idHB2yWVUxipGNJxWrqord3CzZLb9lO7v77MPmFxYjsdtlnevOhU4I4Wh0NnrzGyCp7W/nefxCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0af55a5e63de5f54c811557f40cd4c13/ba381/fullscreen-button.webp 200w,\n/static/0af55a5e63de5f54c811557f40cd4c13/7f61c/fullscreen-button.webp 400w,\n/static/0af55a5e63de5f54c811557f40cd4c13/d00b9/fullscreen-button.webp 800w,\n/static/0af55a5e63de5f54c811557f40cd4c13/92f8c/fullscreen-button.webp 1200w,\n/static/0af55a5e63de5f54c811557f40cd4c13/fad48/fullscreen-button.webp 1600w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0af55a5e63de5f54c811557f40cd4c13/772e8/fullscreen-button.png 200w,\n/static/0af55a5e63de5f54c811557f40cd4c13/e17e5/fullscreen-button.png 400w,\n/static/0af55a5e63de5f54c811557f40cd4c13/5a190/fullscreen-button.png 800w,\n/static/0af55a5e63de5f54c811557f40cd4c13/c1b63/fullscreen-button.png 1200w,\n/static/0af55a5e63de5f54c811557f40cd4c13/29007/fullscreen-button.png 1600w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0af55a5e63de5f54c811557f40cd4c13/5a190/fullscreen-button.png\"\n            alt=\"fullscreen button\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<br/></p>\n<p>記事クリックで記事ページに遷移できたりします。</p>\n<h3 id=\"過去記事を視覚的に俯瞰できるのでとても良い\" style=\"position:relative;\"><a href=\"#%E9%81%8E%E5%8E%BB%E8%A8%98%E4%BA%8B%E3%82%92%E8%A6%96%E8%A6%9A%E7%9A%84%E3%81%AB%E4%BF%AF%E7%9E%B0%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%E3%81%A7%E3%81%A8%E3%81%A6%E3%82%82%E8%89%AF%E3%81%84\" aria-label=\"過去記事を視覚的に俯瞰できるのでとても良い permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>過去記事を視覚的に俯瞰できるのでとても良い</h3>\n<p>以前から関連記事機能は実装していましたが、記事関連マップにすると俯瞰できるので、改めて気付いたことがありました。\n記事関連マップを見る限り自分のブログのメインコンテンツとしては以下ですね。フロントエンド多めです。</p>\n<ul>\n<li>Gatsby(ちょっとReact)</li>\n<li>Vue.js + AppSync</li>\n<li>Angular</li>\n</ul>\n<p>また、まったく関連が存在しない記事も幾つかあることがわかります（Git,Vimあたり）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/50b82ce63ff507ac023bad51eaccd84e/78958/no-relation-posts.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACGklEQVR42o1Rz2sTQRjNvyhIVUQQD/4BHgRRL9KTUpGCCgoVqaA9eKgXqx7USqEkXTVNk0q3SW12UxM32R+zM7M7OzPfk93UBG8+eHwz88083ryvlue5K6VsCiFaUsophWwxxub7U5Z3ppQtLuS0cl6yKaU8HAwGr2oAEEaRlVIiSRjiOAZjDFprSJkhTTk4F+CcQwoBIQTyTEArAZVzWFPAGGOmOmGjhslbxNvXzLB+ncTxS8rygopCkRCS7i4/oRu3F2n50Qr97PuktSZdKNpqefTwdZNW3uzTdjuiJIl1KTiZTOo1yHXknxbscPM8cPIUhClSznFm4RLOXbyCsxcuo/PDxV+sfXiGm4+v4t6L+1j/vFEeVQ6jKGpUXy60sNZksEbNHmlt4PY8HPWHOOj6iOJ01uu4Drac9YoHR19ngkmSTAWzTNk8L6BUgTRNq5yICP8LIpo7DMMQHde13miEQ9dFt9erRJVS8Pw+hsMT+AMfwXhcDaZEEAQYjn7B8zxEYYTxeDx32Gx3sP/gjvGXbtH7jXdkrC2tkVScdo/qtLqxSq3+DoksrYZS9jrdXdr6/pG+9bZpMDkmo40+FazX/CDAaO25PV5aRH1nZ54hFRjnJ/jS3kSQD2DLmE5T6Add7PYaOIz3EKnf/2aYZXIvMaYRGuuINHUYYzOmjDm20FVlyfw8jmMnSRInDuNqzRhrcM47vu+v/gHJaN03IsrzqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/50b82ce63ff507ac023bad51eaccd84e/ba381/no-relation-posts.webp 200w,\n/static/50b82ce63ff507ac023bad51eaccd84e/7f61c/no-relation-posts.webp 400w,\n/static/50b82ce63ff507ac023bad51eaccd84e/d00b9/no-relation-posts.webp 800w,\n/static/50b82ce63ff507ac023bad51eaccd84e/92f8c/no-relation-posts.webp 1200w,\n/static/50b82ce63ff507ac023bad51eaccd84e/d33d4/no-relation-posts.webp 1320w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/50b82ce63ff507ac023bad51eaccd84e/772e8/no-relation-posts.png 200w,\n/static/50b82ce63ff507ac023bad51eaccd84e/e17e5/no-relation-posts.png 400w,\n/static/50b82ce63ff507ac023bad51eaccd84e/5a190/no-relation-posts.png 800w,\n/static/50b82ce63ff507ac023bad51eaccd84e/c1b63/no-relation-posts.png 1200w,\n/static/50b82ce63ff507ac023bad51eaccd84e/78958/no-relation-posts.png 1320w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/50b82ce63ff507ac023bad51eaccd84e/5a190/no-relation-posts.png\"\n            alt=\"no relation posts\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n<br/></p>\n<p>知識は点よりも線にしたほうが強みになるので、今後記事を書く際は、そこらへんの記事の関連線を増やしていく方向で学習を進めようと思います。</p>\n<h3 id=\"今後の予定\" style=\"position:relative;\"><a href=\"#%E4%BB%8A%E5%BE%8C%E3%81%AE%E4%BA%88%E5%AE%9A\" aria-label=\"今後の予定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>今後の予定</h3>\n<p>現在、関連度算出はタグとキーワードの重み付けという非常に簡素なロジックです。\n今後は、記事本文を解析して関連度を詳細に出したり、記事の傾向を解析したり、WordCloudを出したりと色々機能追加できそうです。</p>\n<h2 id=\"cytoscapejsを使ってみた感想\" style=\"position:relative;\"><a href=\"#cytoscapejs%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E6%84%9F%E6%83%B3\" aria-label=\"cytoscapejsを使ってみた感想 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cytoscape.jsを使ってみた感想</h2>\n<h3 id=\"概要\" style=\"position:relative;\"><a href=\"#%E6%A6%82%E8%A6%81\" aria-label=\"概要 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>概要</h3>\n<p>公式ドキュメントは充実しているので実装方法に悩むことはありません。\nCanvasで描画するので、オブジェクトのスタイル指定でCSSは使えないのが若干もどかしいですが、CSSに似たプロパティ設定することで非常に細かいレイアウト調整ができます。\nまたオブジェクト毎にイベント発火時（hover, click, mouseover, etc...）の処理を指定できます。こちらはjQueryっぽい実装です。</p>\n<h3 id=\"テーマ\" style=\"position:relative;\"><a href=\"#%E3%83%86%E3%83%BC%E3%83%9E\" aria-label=\"テーマ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>テーマ</h3>\n<p>公式サイトでは多くのテーマが紹介されています。\nインストールしてuseするだけで簡単に使えます。</p>\n<div class=\"gatsby-code-title\">テーマの使い方</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> cytoscape <span class=\"token keyword\">from</span> <span class=\"token string\">'cytoscape'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> coseBilkent <span class=\"token keyword\">from</span> <span class=\"token string\">'cytoscape-cose-bilkent'</span><span class=\"token punctuation\">;</span>\n\ncytoscape<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span> coseBilkent <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>テーマごとに豊富なオプションが用意されており、以下のように調査できます。</p>\n<div class=\"gatsby-code-title\">テーマの調整</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CytoscapeComponent</span></span>\n  <span class=\"token attr-name\">layout</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'cose-bilkent'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Whether to include labels in node dimensions. Useful for avoiding label overlap</span>\n    <span class=\"token literal-property property\">nodeDimensionsIncludeLabels</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// number of ticks per frame; higher is faster but more jerky</span>\n    <span class=\"token literal-property property\">refresh</span><span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Whether to fit the network view after when done</span>\n    <span class=\"token literal-property property\">fit</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Padding on fit</span>\n    <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Whether to enable incremental mode</span>\n    <span class=\"token literal-property property\">randomize</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Node repulsion (non overlapping) multiplier</span>\n    <span class=\"token literal-property property\">nodeRepulsion</span><span class=\"token operator\">:</span> <span class=\"token number\">100000000</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Ideal (intra-graph) edge length</span>\n    <span class=\"token literal-property property\">idealEdgeLength</span><span class=\"token operator\">:</span> <span class=\"token number\">700</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Divisor to compute edge forces</span>\n    <span class=\"token literal-property property\">edgeElasticity</span><span class=\"token operator\">:</span> <span class=\"token number\">0.45</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Nesting factor (multiplier) to compute ideal edge length for inter-graph edges</span>\n    <span class=\"token literal-property property\">nestingFactor</span><span class=\"token operator\">:</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Gravity force (constant)</span>\n    <span class=\"token literal-property property\">gravity</span><span class=\"token operator\">:</span> <span class=\"token number\">0.20</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Maximum number of iterations to perform</span>\n    <span class=\"token literal-property property\">numIter</span><span class=\"token operator\">:</span> <span class=\"token number\">2500</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Whether to tile disconnected nodes</span>\n    <span class=\"token literal-property property\">tile</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Type of layout animation. The option set is {'during', 'end', false}</span>\n    <span class=\"token literal-property property\">animate</span><span class=\"token operator\">:</span> <span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Amount of vertical space to put between degree zero nodes during tiling (can also be a function)</span>\n    <span class=\"token literal-property property\">tilingPaddingVertical</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Amount of horizontal space to put between degree zero nodes during tiling (can also be a function)</span>\n    <span class=\"token literal-property property\">tilingPaddingHorizontal</span><span class=\"token operator\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Gravity range (constant) for compounds</span>\n    <span class=\"token literal-property property\">gravityRangeCompound</span><span class=\"token operator\">:</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Gravity force (constant) for compounds</span>\n    <span class=\"token literal-property property\">gravityCompound</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Gravity range (constant)</span>\n    <span class=\"token literal-property property\">gravityRange</span><span class=\"token operator\">:</span> <span class=\"token number\">3.8</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Initial cooling factor for incremental layout</span>\n    <span class=\"token literal-property property\">initialEnergyOnIncremental</span><span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">/></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h3 id=\"拡張機能\" style=\"position:relative;\"><a href=\"#%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD\" aria-label=\"拡張機能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>拡張機能</h3>\n<p>拡張機能も豊富です。ただ一部jQuery依存の拡張機能もあります。たとえば、ズーム機能を提供する<a href=\"https://github.com/cytoscape/cytoscape.js-panzoom\">cytoscape.js-panzoom</a>などです。今回jQueryは使えないので（GatsbyでReactベースなので）、ズーム機能は自前実装しました。スタイルや細かい挙動など設定項目が非常に多く、結構手間なので自前実装はオススメしません。</p>\n<h3 id=\"react-cytoscapejsハマりポイント\" style=\"position:relative;\"><a href=\"#react-cytoscapejs%E3%83%8F%E3%83%9E%E3%82%8A%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\" aria-label=\"react cytoscapejsハマりポイント permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>react-cytoscape.jsハマりポイント</h3>\n<p>GatsbyでCytoscape.jsを使えるようにするため<a href=\"https://github.com/plotly/react-cytoscapejs\">react-cytoscape.js</a>を採用しました。\nただ2点ハマりポイントがあったので紹介します。</p>\n<h4 id=\"1-wheelsensitivityが使えない\" style=\"position:relative;\"><a href=\"#1-wheelsensitivity%E3%81%8C%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84\" aria-label=\"1 wheelsensitivityが使えない permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. wheelsensitivityが使えない</h4>\n<p>Cytoscape.jsは、wheelsensitivityというプロパティを指定すれば、マウスホイールで拡大・縮小する時の拡大率を調整できます。これを設定しないとマウスホイールで拡大したときに、急に拡大されて、自分が今どこにいるのかわからなくなります。wheelsensitivityを使えば拡大率を調整できるので、それを防ぐことができます。\nただコレreact-cytoscapeではサポートしていません。そのため今回は拡大率調整を断念しました。</p>\n<h4 id=\"2-gatsbyビルド時にエラー\" style=\"position:relative;\"><a href=\"#2-gatsby%E3%83%93%E3%83%AB%E3%83%89%E6%99%82%E3%81%AB%E3%82%A8%E3%83%A9%E3%83%BC\" aria-label=\"2 gatsbyビルド時にエラー permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Gatsbyビルド時にエラー</h4>\n<p><code class=\"language-text\">WebpackError: ReferenceError: window is not defined</code>というエラーが出ます。react-cytoscape.jsではwindowオブジェクトを直参照しており、Gatsbyビルド時に、webpackに怒られます。Gatsbyではwindowオブジェクトを直参照できないようです。</p>\n<p>対策は<a href=\"https://github.com/gatsbyjs/gatsby/issues/309#issuecomment-302043875\">GatsbyのIssue</a>にもあがっており、以下のようにライブラリの中身を直接書き換えました。</p>\n<ul>\n<li><code class=\"language-text\">node_modules\\react-cytoscapejs\\dist\\react-cytoscape.js</code>を書き換えます。</li>\n<li><code class=\"language-text\">window</code>を<code class=\"language-text\">windowGlobal </code>に置換します</li>\n<li>冒頭に<code class=\"language-text\">const windowGlobal = typeof window !== 'undefined' &amp;&amp; window;</code>を追記します</li>\n</ul>\n<p>これでビルドが通ります。ただ手動でやるのは無理やり感があるので、npmのpostinstallのスクリプトで書き換える方法を検討中です。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回は、記事関連マップの紹介と<a href=\"http://js.cytoscape.org/\">Cytoscape.js</a>の使用感をご紹介しました。業務でもWebアプリでデータを可視化したいという要件は割とある気がするので、そんなときはCytoscape.jsの導入を検討しようと思います🍅</p>","excerpt":"なにこれ 以前の記事で紹介したタグとキーワードから関連記事を算出するロジックと、Cytoscape.jsを用いて記事の関連情報を視覚的に確認できるマップを作りました。\n今回はそのマップの紹介とCytoscape.jsを使ってみた感想です。 記事関連マップ 使い方 URL…","frontmatter":{"slug":"/posts-relation-map-with-cytoscape-in-gatsby","title":"GatsbyでCytoscape.jsを使って記事関連マップを作った","date":"2019-05-01T18:00:00.000+09:00","tags":["Gatsby","Cytoscape.js"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/05/posts-relation-map-with-cytoscape-in-gatsby.png"},"headingsDetail":[{"id":"なにこれ","value":"なにこれ","depth":2,"parents":[]},{"id":"記事関連マップ","value":"記事関連マップ","depth":2,"parents":[]},{"id":"使い方","value":"使い方","depth":3,"parents":[{"id":"記事関連マップ","value":"記事関連マップ","depth":2}]},{"id":"過去記事を視覚的に俯瞰できるのでとても良い","value":"過去記事を視覚的に俯瞰できるのでとても良い","depth":3,"parents":[{"id":"記事関連マップ","value":"記事関連マップ","depth":2}]},{"id":"今後の予定","value":"今後の予定","depth":3,"parents":[{"id":"記事関連マップ","value":"記事関連マップ","depth":2}]},{"id":"cytoscapejsを使ってみた感想","value":"Cytoscape.jsを使ってみた感想","depth":2,"parents":[]},{"id":"概要","value":"概要","depth":3,"parents":[{"id":"cytoscapejsを使ってみた感想","value":"Cytoscape.jsを使ってみた感想","depth":2}]},{"id":"テーマ","value":"テーマ","depth":3,"parents":[{"id":"cytoscapejsを使ってみた感想","value":"Cytoscape.jsを使ってみた感想","depth":2}]},{"id":"拡張機能","value":"拡張機能","depth":3,"parents":[{"id":"cytoscapejsを使ってみた感想","value":"Cytoscape.jsを使ってみた感想","depth":2}]},{"id":"react-cytoscapejsハマりポイント","value":"react-cytoscape.jsハマりポイント","depth":3,"parents":[{"id":"cytoscapejsを使ってみた感想","value":"Cytoscape.jsを使ってみた感想","depth":2}]},{"id":"1-wheelsensitivityが使えない","value":"1. wheelsensitivityが使えない","depth":4,"parents":[{"id":"react-cytoscapejsハマりポイント","value":"react-cytoscape.jsハマりポイント","depth":3},{"id":"cytoscapejsを使ってみた感想","value":"Cytoscape.jsを使ってみた感想","depth":2}]},{"id":"2-gatsbyビルド時にエラー","value":"2. Gatsbyビルド時にエラー","depth":4,"parents":[{"id":"react-cytoscapejsハマりポイント","value":"react-cytoscape.jsハマりポイント","depth":3},{"id":"cytoscapejsを使ってみた感想","value":"Cytoscape.jsを使ってみた感想","depth":2}]},{"id":"まとめ","value":"まとめ","depth":2,"parents":[]}]}},"pageContext":{"thumbnail":{"node":{"relativePath":"thumbnail/2019/05/posts-relation-map-with-cytoscape-in-gatsby.png","name":"posts-relation-map-with-cytoscape-in-gatsby","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/1e8c7d9c1152418a225393c40f9766cf/d8487/posts-relation-map-with-cytoscape-in-gatsby.png","srcSet":"/static/1e8c7d9c1152418a225393c40f9766cf/6b9a5/posts-relation-map-with-cytoscape-in-gatsby.png 300w,\n/static/1e8c7d9c1152418a225393c40f9766cf/bd056/posts-relation-map-with-cytoscape-in-gatsby.png 600w,\n/static/1e8c7d9c1152418a225393c40f9766cf/d8487/posts-relation-map-with-cytoscape-in-gatsby.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/1e8c7d9c1152418a225393c40f9766cf/b0a02/posts-relation-map-with-cytoscape-in-gatsby.webp 300w,\n/static/1e8c7d9c1152418a225393c40f9766cf/d57cb/posts-relation-map-with-cytoscape-in-gatsby.webp 600w,\n/static/1e8c7d9c1152418a225393c40f9766cf/27c04/posts-relation-map-with-cytoscape-in-gatsby.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":632}}}},"siteMetadata":{"title":"Masashi Ishikawa's portfolio","author":"Masashi Ishikawa"},"slug":"/posts-relation-map-with-cytoscape-in-gatsby","relatedPosts":[{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>ブログについて以下２点改修したので備忘録を残します。</p>\n<ul>\n<li><strong>Gatsbyをv2からv5に更新</strong>：しばらくブログを更新しない間にGatsbyの最新バージョンはv2からv5になっていたのでバージョンアップしました。</li>\n<li><strong>＋αの機能を削除</strong>：いままではプロフィールページなど充実させて機能をモリモリにしていましたが、今後はメンテコストを下げて記事投稿に集中したいからです。</li>\n</ul>\n<h2 id=\"gatsbyのバージョンアップ\" style=\"position:relative;\"><a href=\"#gatsby%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97\" aria-label=\"gatsbyのバージョンアップ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsbyのバージョンアップ</h2>\n<p>忘れていたり古くなった私のGatsbyの知識をアップデートするため、\npackage.jsonのライブラリ更新ではなく、<code class=\"language-text\">npm init gatsby blog -- -y -ts</code>でアプリを新規作成して、必用な機能だけ移行する形を取りました。</p>\n<p>ここではライブラリのバージョンアップだけではうまく行かない点について列挙します。</p>\n<h3 id=\"gatsby-image-gatsby-background-image\" style=\"position:relative;\"><a href=\"#gatsby-image-gatsby-background-image\" aria-label=\"gatsby image gatsby background image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-image, gatsby-background-image</h3>\n<p>画像を扱うライブラリが大きく変わっていました。\nいずれも公式サイトに従って書き換えました。</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.com/docs/reference/release-notes/image-migration-guide/\">gatsby-image移行方法 | Gatsby公式サイト</a></li>\n<li><a href=\"https://www.gatsbyjs.com/plugins/gatsby-background-image/#gatsby-34--gatsby-plugin-image\">gatsby-background-iamgeプラグインのREADME</a></li>\n</ul>\n<p>またgatsby-background-imageは<a href=\"https://github.com/timhagn/gatsby-background-image/issues/179\">GitHubのissue</a>で記載があるようにGatsby V5の場合はビルドエラーが出ます。やむをえず<code class=\"language-text\">npm ci</code>や<code class=\"language-text\">npm i</code>実行時は<code class=\"language-text\">--legacy-peer-deps</code>を付与しています。</p>\n<h3 id=\"emotion\" style=\"position:relative;\"><a href=\"#emotion\" aria-label=\"emotion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>emotion</h3>\n<p><a href=\"https://emotion.sh/docs/emotion-11#package-renaming\">Emotion11でパッケージ名が変わっている</a>のでインポート文を変えました。</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-diff line-numbers\"><code class=\"language-diff\"><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span> import { css } from '@emotion/core'\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span> import { css } from '@emotion/react'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<br/>\n<p>またtsxファイルでcss属性に対してエラーが出るようになったので、<a href=\"https://emotion.sh/docs/eslint-plugin-react\">Emotionの公式サイト</a>を参考にeslintrc.jsのruleに以下追加しました。</p>\n<div class=\"gatsby-code-title\">eslintrc.js</div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-diff line-numbers\"><code class=\"language-diff\">{\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> \"rules\": {\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>    \"react/no-unknown-property\": [\"error\", { \"ignore\": [\"css\"] }]\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> }\n</span>}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"削除した機能\" style=\"position:relative;\"><a href=\"#%E5%89%8A%E9%99%A4%E3%81%97%E3%81%9F%E6%A9%9F%E8%83%BD\" aria-label=\"削除した機能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>削除した機能</h2>\n<p>改修過程で記事投稿に関係のないプロフィールのような付加価値的な機能と、ビルド時間が増大する機能については、移行しないことにしました。\n当時はフロントエンドのスキル情報のためのプレイグラウンドとして色んな機能を実装していましたが、今は技術調査結果や読後レポートを公開する場として使いたいからです。</p>\n<h3 id=\"qiita記事情報取得表示\" style=\"position:relative;\"><a href=\"#qiita%E8%A8%98%E4%BA%8B%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97%E8%A1%A8%E7%A4%BA\" aria-label=\"qiita記事情報取得表示 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Qiita記事情報取得・表示</h3>\n<p>これまではQiita連携のプラグインを使っていましたが、以下理由から廃止しました。</p>\n<ul>\n<li>Qiita記事とGatsby側記事の差分を埋めるため、nodeを加工して独自のIFを設ける必要があり、ブログの作りが複雑化してしまう</li>\n<li>1年以上の時間軸で考えるとプラグインはメンテコストがかかる</li>\n<li>Qiita側でアクセストークンの発行が必要でメンテコストがかかる</li>\n</ul>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://takumon.com/2018/11/11/\" data-iframely-url=\"//cdn.iframe.ly/api/iframe?url=https%3A%2F%2Ftakumon.com%2F2018%2F11%2F11%2F&key=0658bf78be97cafcf2b0b9f96c1270ee\"></a></div></div>\n<h3 id=\"githubリポジトリ情報取得表示\" style=\"position:relative;\"><a href=\"#github%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97%E8%A1%A8%E7%A4%BA\" aria-label=\"githubリポジトリ情報取得表示 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GitHubリポジトリ情報取得・表示</h3>\n<p>当時気張って作ってみたものの、普段の記事作成作業の生産性を下げるので廃止しました。</p>\n<ul>\n<li>GitHubでアクセストークンの発行が必要でメンテコストがかかる</li>\n<li>ビルド時間が少し長くなる</li>\n<li>ローカルで頻繁にビルドするとGitHubアクセス制限回数に到達しGitHub API呼び出しで401エラーになる</li>\n</ul>\n<h3 id=\"wordcloud表示記事文章中の頻出単語可視化d3jsのよる記事関連性の可視化\" style=\"position:relative;\"><a href=\"#wordcloud%E8%A1%A8%E7%A4%BA%E8%A8%98%E4%BA%8B%E6%96%87%E7%AB%A0%E4%B8%AD%E3%81%AE%E9%A0%BB%E5%87%BA%E5%8D%98%E8%AA%9E%E5%8F%AF%E8%A6%96%E5%8C%96d3js%E3%81%AE%E3%82%88%E3%82%8B%E8%A8%98%E4%BA%8B%E9%96%A2%E9%80%A3%E6%80%A7%E3%81%AE%E5%8F%AF%E8%A6%96%E5%8C%96\" aria-label=\"wordcloud表示記事文章中の頻出単語可視化d3jsのよる記事関連性の可視化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WordCloud表示（記事文章中の頻出単語可視化）、d3.jsのよる記事関連性の可視化</h3>\n<p>これらも当時気張って作ってみたものの廃止しました</p>\n<ul>\n<li>必要はライブラリが多い、1年立つと使い方を忘れてる</li>\n<li>ビルド時間が大幅に増加してしまう</li>\n<li>Gatsby v2→5更新時に画像処理系ライブラリ起因でエラー多発</li>\n</ul>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://takumon.com/wordcloud-in-gatsby-blog\" data-iframely-url=\"//cdn.iframe.ly/api/iframe?url=https%3A%2F%2Ftakumon.com%2Fwordcloud-in-gatsby-blog%2F&key=0658bf78be97cafcf2b0b9f96c1270ee\"></a></div></div>\n<h3 id=\"ビルド処理gatsby-parallel-runnerによる画像生成処理の並列化\" style=\"position:relative;\"><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E5%87%A6%E7%90%86gatsby-parallel-runner%E3%81%AB%E3%82%88%E3%82%8B%E7%94%BB%E5%83%8F%E7%94%9F%E6%88%90%E5%87%A6%E7%90%86%E3%81%AE%E4%B8%A6%E5%88%97%E5%8C%96\" aria-label=\"ビルド処理gatsby parallel runnerによる画像生成処理の並列化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ビルド処理：gatsby-parallel-runnerによる画像生成処理の並列化</h3>\n<p>上３つの廃止に伴いビルド時間も短縮されました。\n当時ビルド時間短縮のために導入していた本機能も、Google Cloudとの連携といった煩わしさがあったので今回を機に廃止しました。</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://takumon.com/optimizations-for-faster-gatsby-builds\" data-iframely-url=\"//cdn.iframe.ly/api/iframe?url=https%3A%2F%2Ftakumon.com%2Foptimizations-for-faster-gatsby-builds%2F%231-%25E7%2594%25BB%25E5%2583%258F%25E7%2594%259F%25E6%2588%2590%25E5%2587%25A6%25E7%2590%2586%25E3%2582%2592%25E4%25B8%25A6%25E5%2588%2597%25E5%258C%2596%25E3%2581%2599%25E3%2582%258B&key=0658bf78be97cafcf2b0b9f96c1270ee\"></a></div></div>\n<h3 id=\"ビルド処理画像縦横幅縮小画質低減\" style=\"position:relative;\"><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E5%87%A6%E7%90%86%E7%94%BB%E5%83%8F%E7%B8%A6%E6%A8%AA%E5%B9%85%E7%B8%AE%E5%B0%8F%E7%94%BB%E8%B3%AA%E4%BD%8E%E6%B8%9B\" aria-label=\"ビルド処理画像縦横幅縮小画質低減 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ビルド処理：画像縦横幅縮小・画質低減</h3>\n<p>以下理由から廃止しました。</p>\n<ul>\n<li>WordCloudの部分でもそうでしたが画像処理系は処理が重く、ライブラリバージョンアップでエラーも付き物</li>\n<li>サムネイル画像を最適なサイズ・画質で作る環境は別で整えたので画像加工処理自体が不要になった</li>\n</ul>\n<h3 id=\"ビルド処理circle-ciでのビルドnetlifyへのデプロイ\" style=\"position:relative;\"><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E5%87%A6%E7%90%86circle-ci%E3%81%A7%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89netlify%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\" aria-label=\"ビルド処理circle ciでのビルドnetlifyへのデプロイ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ビルド処理：Circle CIでのビルドNetlifyへのデプロイ</h3>\n<p>GitHub Actionsに乗り換えました</p>\n<h3 id=\"renovate\" style=\"position:relative;\"><a href=\"#renovate\" aria-label=\"renovate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Renovate</h3>\n<p><a href=\"https://github.com/renovatebot/renovate\">Renovate</a>（リポジトリで利用しているライブラリのバージョンアップを自動でしてくれるツール）は廃止しました。放っておくとプルリクが溜まり続けるので、１人で長期間メンテするリポジトリの場合は手動が良いと感じました。</p>\n<h2 id=\"残している機能\" style=\"position:relative;\"><a href=\"#%E6%AE%8B%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E6%A9%9F%E8%83%BD\" aria-label=\"残している機能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>残している機能</h2>\n<h3 id=\"プラグイン系\" style=\"position:relative;\"><a href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E7%B3%BB\" aria-label=\"プラグイン系 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プラグイン系</h3>\n<ul>\n<li><strong>ダークモード切り替え</strong>：<a href=\"https://www.gatsbyjs.com/plugins/gatsby-plugin-dark-mode/\">gatsby-plugin-dark-mode</a>を使っていましたが、TypeScriptのlint errorを解消するため<a href=\"https://github.com/kagamichan/gatsby-plugin-dark-mode\">@skagami/gatsby-plugin-dark-mode</a>に移行しました。</li>\n<li><strong>サイトマップ作成</strong>：<a href=\"https://www.gatsbyjs.com/plugins/gatsby-plugin-sitemap/\">gatsby-plugin-sitemap</a></li>\n<li><strong>マークダウン表現拡張</strong>：現状維持でプラグイン郡を使っています</li>\n<li><strong>クエリからの型自動生成</strong>：<a href=\"https://www.gatsbyjs.com/plugins/gatsby-plugin-typegen/\">gatsby-plugin-typegen</a>を使っています</li>\n<li><strong>文字スタイルテンプレート</strong>：<a href=\"https://www.gatsbyjs.com/plugins/gatsby-plugin-typography/\">gatsby-plugin-typography</a>、テンプレートは<a href=\"https://www.npmjs.com/package/typography-theme-wordpress-2016\">typography-theme-wordpress-2016</a>を使っています</li>\n<li><strong>manifestファイル作成</strong>：gatsby-plugin-manifest</li>\n</ul>\n<h3 id=\"自作系\" style=\"position:relative;\"><a href=\"#%E8%87%AA%E4%BD%9C%E7%B3%BB\" aria-label=\"自作系 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>自作系</h3>\n<ul>\n<li>目次作成</li>\n</ul>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://takumon.com/2018/10/28/\" data-iframely-url=\"//cdn.iframe.ly/api/iframe?url=http%3A%2F%2Ftakumon.com%2F2018%2F10%2F28%2F&key=0658bf78be97cafcf2b0b9f96c1270ee\"></a></div></div>\n<br/>\n<br/>\n<ul>\n<li>関連記事表示</li>\n</ul>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://takumon.com/gatsby-related-posts-like-hugo\" data-iframely-url=\"//cdn.iframe.ly/api/iframe?url=http%3A%2F%2Ftakumon.com%2Fgatsby-related-posts-like-hugo&key=0658bf78be97cafcf2b0b9f96c1270ee\"></a></div></div>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>だいぶスッキリして記事が書きやすくなりました。\n1年以上の時間軸で自作ブログの運用を考えると、外部連携を減らしてリポジトリのソースコードだけで完結すること、環境変数などの構成管理対象外の情報を極力減らすことがポイントだと感じました🍅</p>","excerpt":"なにこれ ブログについて以下２点改修したので備忘録を残します。 Gatsbyをv2からv5に更新：しばらくブログを更新しない間にGatsbyの最新バージョンはv2からv5になっていたのでバージョンアップしました。 ＋α…","frontmatter":{"slug":"/migrate-gatsby-v2-to-v5","title":"Gatsbyバージョンアップ（v2 to v5）","date":"2023-04-06T09:00:00.000+09:00","tags":["Gatsby"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2023/04/migrate-gatsby-v2-to-v5.png","category":"blog"}},{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>自分のブログ(Gatsby製)のビルドが遅すぎてNetlifyでタイムアウトしてしまうので、ビルドチューニングをしました。\n15分以上かかっていたビルドが7分以下になり50%短縮できたので、その時の知見をまとめます。\n割と地味な作業が多いですが、Gatsbyのビルド時間短縮に関するTipsを効果がある順にご紹介します。</p>\n<ul>\n<li>🚀<a href=\"#1-%E7%94%BB%E5%83%8F%E7%94%9F%E6%88%90%E5%87%A6%E7%90%86%E3%82%92%E4%B8%A6%E5%88%97%E5%8C%96%E3%81%99%E3%82%8B\">1. 画像生成処理を並列化する</a></li>\n<li>🚅<a href=\"#2-%E5%BF%85%E8%A6%81%E3%81%AA%E7%94%BB%E5%83%8F%E3%81%A0%E3%81%91%E3%82%AF%E3%82%A8%E3%83%AA%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\">2. 必要な画像だけクエリで取得する</a></li>\n<li>🚂<a href=\"#3-%E7%94%9F%E6%88%90%E7%94%BB%E5%83%8F%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99\">3. 生成画像の種類を減らす</a></li>\n<li>🚗<a href=\"#4-%E7%94%BB%E5%83%8F%E3%81%AE%E7%B8%A6%E6%A8%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%82%92%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%99%E3%82%8B\">4. 画像の縦横サイズを最適化する</a></li>\n<li>🚴🏻<a href=\"#5-%E7%94%BB%E5%83%8F%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%B5%E3%82%A4%E3%82%BA%E3%82%92%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B\">5. 画像のファイルサイズを圧縮する</a></li>\n<li>🏃🏻<a href=\"#6-%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B%E7%94%BB%E5%83%8F%E3%82%92%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%EF%BC%86%E4%BD%8E%E3%82%AF%E3%82%AA%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AB%E3%81%99%E3%82%8B\">6. 生成する画像をシンプル＆低クオリティにする</a></li>\n<li>🏊🏻<a href=\"#7-netlify-plugin-gatsby-cache%E3%82%92%E4%BD%BF%E3%81%86\">7. netlify-plugin-gatsby-cacheを使う</a></li>\n<li>💎<a href=\"#%E7%95%AA%E5%A4%96%E7%B7%A81-circle-ci%E3%81%A7%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6netlify%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B\">番外編1: Circle CIでビルドしてNetlifyにデプロイする</a></li>\n</ul>\n<h2 id=\"なぜビルドが遅いのか--画像生成に時間がかかっている\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%9C%E3%83%93%E3%83%AB%E3%83%89%E3%81%8C%E9%81%85%E3%81%84%E3%81%AE%E3%81%8B--%E7%94%BB%E5%83%8F%E7%94%9F%E6%88%90%E3%81%AB%E6%99%82%E9%96%93%E3%81%8C%E3%81%8B%E3%81%8B%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B\" aria-label=\"なぜビルドが遅いのか  画像生成に時間がかかっている permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なぜビルドが遅いのか → 画像生成に時間がかかっている</h2>\n<p>ビルド時間の内訳を見たところ、<code class=\"language-text\">Generating image thumbnails</code>に10分以上かかっており大半を締めていました。\nこれは<a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">gatsby-image</a>で様々なブラウザ幅に最適化するために、サイズ違いの画像を複数枚生成するための処理です。</p>\n<p>gatsby-imageまわりのビルドチューニングについて、日本の記事をあまり見かけませんが、\n英語の記事やGitHubでは、画像生成が遅いという記事をちらほら見かけました。</p>\n<ul>\n<li><a href=\"https://www.netlify.com/blog/2020/02/25/gatsby-build-speed-improvements-with-parallel-image-processing/\">Improve Gatsby Build Speeds With Parallel Image Processing</a></li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/issues/8056\">Gatsby build on Netlify fails(Image generation): Command did not finish within the time limit · Issue #8056 · gatsbyjs/gatsby</a></li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/issues/23033\">Gatsby stuck on generating image thumbnails · Issue #23033 · gatsbyjs/gatsby</a></li>\n</ul>\n<p>あとGatsbyの公式ドキュメントでも画像の取り扱いについて言及されています。</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/docs/preoptimizing-images/\">Preoptimizing Your Images | GatsbyJS</a></li>\n</ul>\n<p>そのため、本記事では、いかに画像生成処理の時間を短縮するかをメインにTipsを紹介していきます。</p>\n<h2 id=\"1-画像生成処理を並列化する\" style=\"position:relative;\"><a href=\"#1-%E7%94%BB%E5%83%8F%E7%94%9F%E6%88%90%E5%87%A6%E7%90%86%E3%82%92%E4%B8%A6%E5%88%97%E5%8C%96%E3%81%99%E3%82%8B\" aria-label=\"1 画像生成処理を並列化する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 画像生成処理を並列化する</h2>\n<p><a href=\"https://github.com/netlify/gatsby-parallel-runner\">gatsby-parallel-runner</a>で画像生成処理を並列化します。\n何をやっているかというと、gatsby buildで一番重い画像生成処理を、<a href=\"https://console.cloud.google.com/\">Google Cloud Platform</a>(以降GCP)に投げて、並列で処理して結果を受け取るというプラグインです。GCPのアカウントが必要ですが、この方法が一番楽に劇的にビルド時間を短縮できます。\n<a href=\"https://www.netlify.com/blog/2020/02/25/gatsby-build-speed-improvements-with-parallel-image-processing/\">Netlifyの記事</a>では6分21秒かかっていたビルドが3分22秒、およそ半分になったそうです。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a917a9b6980544d6e3f6ad9fa2793ab1/01fc7/parallel-speed-comparison.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFmV1wOZH//xAAZEAEAAwEBAAAAAAAAAAAAAAABAAMEEBH/2gAIAQEAAQUCa9HhXoQNEY8//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERElH/2gAIAQMBAT8BlFlh/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHBAAAQMFAAAAAAAAAAAAAAAAAQADIRETIIGR/9oACAEBAAY/Aq3RxS4BpSRh/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARMZEhUf/aAAgBAQABPyG0HjhNzS+F4a7UTevZYxewWtZ//9oADAMBAAIAAwAAABALz//EABYRAQEBAAAAAAAAAAAAAAAAAAABYf/aAAgBAwEBPxDBQ//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPxB0jP/EAB0QAQACAgIDAAAAAAAAAAAAAAEAIRFxQVFhscH/2gAIAQEAAT8QuEhfRz9hfnziPNQQN5pAK1iUFfWUQADSIgZTbP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a917a9b6980544d6e3f6ad9fa2793ab1/ba381/parallel-speed-comparison.webp 200w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/7f61c/parallel-speed-comparison.webp 400w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/d00b9/parallel-speed-comparison.webp 800w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/92f8c/parallel-speed-comparison.webp 1200w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/fad48/parallel-speed-comparison.webp 1600w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/919bf/parallel-speed-comparison.webp 3200w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a917a9b6980544d6e3f6ad9fa2793ab1/e07e9/parallel-speed-comparison.jpg 200w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/066f9/parallel-speed-comparison.jpg 400w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/4b190/parallel-speed-comparison.jpg 800w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/e5166/parallel-speed-comparison.jpg 1200w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/b17f8/parallel-speed-comparison.jpg 1600w,\n/static/a917a9b6980544d6e3f6ad9fa2793ab1/01fc7/parallel-speed-comparison.jpg 3200w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a917a9b6980544d6e3f6ad9fa2793ab1/4b190/parallel-speed-comparison.jpg\"\n            alt=\"parallel speed comparison\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>設定方法は<a href=\"https://www.netlify.com/blog/2020/02/25/gatsby-build-speed-improvements-with-parallel-image-processing/\">Netlifyの記事</a>にキャプチャ付きで詳しく載っているので、そちらをご覧いただければ簡単に設定できると思います。GCPの環境をCLIで構築してNetlifyに環境変数を設定すればすぐに使えるようになります。</p>\n<h2 id=\"2-必要な画像だけクエリで取得する\" style=\"position:relative;\"><a href=\"#2-%E5%BF%85%E8%A6%81%E3%81%AA%E7%94%BB%E5%83%8F%E3%81%A0%E3%81%91%E3%82%AF%E3%82%A8%E3%83%AA%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\" aria-label=\"2 必要な画像だけクエリで取得する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 必要な画像だけクエリで取得する</h2>\n<p>フィルタを全く指定しないクエリは、全ての画像を取得してしまうのでビルド時間が大幅に増えてしまいます。\nそのため、クエリで取得する画像は他画像とフォルダを分けて、クエリのフィルタ条件を指定するなりしましょう。\nそうすることで不必要に画像を取得せずに済み、ビルド時間を短縮できます。</p>\n<div class=\"gatsby-code-title\">フィルタ条件を付けて必要な画像だけ取得する</div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-diff line-numbers\"><code class=\"language-diff\">query {\n<span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>  // 全画像を取得してしまう\n<span class=\"token prefix deleted\">-</span>  allFile {\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  // 検索条件を指定して必要な画像だけ取得するようにする\n<span class=\"token prefix inserted\">+</span>  allFile(filter: {relativePath: {regex: \"/^thumbnail/*/\"}}) {\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>   edges {\n<span class=\"token prefix unchanged\"> </span>     node {\n<span class=\"token prefix unchanged\"> </span>       childImageSharp {\n<span class=\"token prefix unchanged\"> </span>         fluid {\n<span class=\"token prefix unchanged\"> </span>           ...GatsbyImageSharpFluid\n<span class=\"token prefix unchanged\"> </span>         }\n<span class=\"token prefix unchanged\"> </span>       }\n<span class=\"token prefix unchanged\"> </span>     }\n<span class=\"token prefix unchanged\"> </span>   }\n<span class=\"token prefix unchanged\"> </span> }\n</span>}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h3 id=\"クエリのフィルタ条件をcontext経由で指定する\" style=\"position:relative;\"><a href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E6%9D%A1%E4%BB%B6%E3%82%92context%E7%B5%8C%E7%94%B1%E3%81%A7%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B\" aria-label=\"クエリのフィルタ条件をcontext経由で指定する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>クエリのフィルタ条件をContext経由で指定する</h3>\n<p>例えば、トップページの上部にピックアップした３つ記事のサムネイル付きで表示する場合、\n3つのサムネイル画像だけ取得するクエリを定義したいところですが、クエリに画像のパスをフィルタ条件としてハードコードしたくはないので、一旦、全てのサムネイルをクエリで取得して、JS(コンポーネント)中で3つにフィルタするようなケースがあります。この場合、不必要な画像も取得してしまうのでビルド時間が増えます。</p>\n<p>StaticQueryなどは、その名の通りStaticなのでJS中の変数をフィルタ条件として使うことができませんが、\nページテンプレートに指定しているコンポーネントのクエリではContextの値がフィルタ条件として使えます。\nこれを利用して以下のように、3つの画像だけ取得するクエリを定義でき、不必要に画像を生成せずに済み、ビルド時間を短縮できます。</p>\n<div class=\"gatsby-code-title\">config/featured-posts.js(クエリのフィルタ条件を設定ファイルに定義する)</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// 設定ファイルで3つの画像パスを指定する</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">featuredPosts</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'/blog/2019/05/09'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'/blog/2018/05/08'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'/blog/2016/03/18'</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<div class=\"gatsby-code-title\">gatsby-node.js(Contextにクエリのフィルタ条件を指定する)</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// 設定ファイルを読み込む</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> featuredPosts <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./config/featured-posts.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 中略</span>\n  \n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// ページ生成時にContextとして渡す</span></span>  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> postTemplate<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">featuredPostPathList</span><span class=\"token operator\">:</span> featuredPosts<span class=\"token punctuation\">,</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 中略</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<div class=\"gatsby-code-title\">src/templates/post.jsx(Contextに指定した値をクエリのフィルタ条件に指定する)</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token comment\">// 中略</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token string\">  query($featuredPostPathList: [String]) {</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">    allMarkdownRemark(filter: { frontmatter: { path: { in: $featuredPostPathList } } }) {</span></span><span class=\"token string\">      edges {</span>\n<span class=\"token string\">        node {</span>\n<span class=\"token string\">          frontmatter {</span>\n<span class=\"token string\">            cover {</span>\n<span class=\"token string\">              childImageSharp {</span>\n<span class=\"token string\">                fluid {</span>\n<span class=\"token string\">                  ...GatsbyImageSharpFluid</span>\n<span class=\"token string\">                }</span>\n<span class=\"token string\">              }</span>\n<span class=\"token string\">            }</span>\n<span class=\"token string\">          }</span>\n<span class=\"token string\">        }</span>\n<span class=\"token string\">      }</span>\n<span class=\"token string\">    }</span>\n<span class=\"token string\">  }</span>\n<span class=\"token string\"></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 中略</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>なお<code class=\"language-text\">src/pages/index.jsx</code>のように<code class=\"language-text\">gatsby-node.js</code>で明示的にページ生成しないようなコンポーネントでも、以下のように<code class=\"language-text\">gatsby-node.js</code>の<code class=\"language-text\">onCreatePage</code>でページを再生成することでContextを指定できます。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreatePage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage<span class=\"token punctuation\">,</span> deletePage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n\n  <span class=\"token comment\">// ルートページの場合のみ処理継続</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span>path <span class=\"token operator\">!==</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// いったんルートページを削除</span>\n  <span class=\"token function\">deletePage</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// pageオブジェクトをもとにルートページを再生成</span>\n  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>page<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>page<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// Contextにクエリのフィルタ条件を指定</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">featuredPostPathList</span><span class=\"token operator\">:</span> featuredPosts<span class=\"token punctuation\">,</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h2 id=\"3-生成画像の種類を減らす\" style=\"position:relative;\"><a href=\"#3-%E7%94%9F%E6%88%90%E7%94%BB%E5%83%8F%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99\" aria-label=\"3 生成画像の種類を減らす permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 生成画像の種類を減らす</h2>\n<p>以下のように同じ画像でも、記事埋め込み用、OGP画像用などに違う縦横サイズ、クオリティを指定していると、画像生成枚数が増えて、ビルド時間も増えてしまいます。\n少しの違いであれば、ある程度妥協して同じ縦横サイズ、クオリティを指定して、生成画像枚数を減らしましょう。\nこれにより、大幅にビルド時間を短縮できます。</p>\n<div class=\"gatsby-code-title\">縦横幅、クオリティを統一して生成画像枚数を減らす</div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-diff line-numbers\"><code class=\"language-diff\"><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> query {\n<span class=\"token prefix unchanged\"> </span>   images: allFile(filter: {relativePath: {regex: \"/^thumbnail/*/\"}}) {\n<span class=\"token prefix unchanged\"> </span>     edges {\n<span class=\"token prefix unchanged\"> </span>       node {\n<span class=\"token prefix unchanged\"> </span>         childImageSharp {\n</span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>            // 記事の最大幅にあわせた少し小さめで低品質な画像を取得\n<span class=\"token prefix deleted\">-</span>            fluid(maxWidth: 800, quality: 50, pngQuality: 50) {\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>            // 生成画像枚数を減らすために、あえて縦横幅、クオリティをサムネイルに合わせる\n<span class=\"token prefix inserted\">+</span>            fluid(maxWidth: 1200, quality: 90, pngQuality: 90) {\n</span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span>             ...GatsbyImageSharpFluid\n<span class=\"token prefix unchanged\"> </span>           }\n<span class=\"token prefix unchanged\"> </span>         }\n<span class=\"token prefix unchanged\"> </span>       }\n<span class=\"token prefix unchanged\"> </span>     }\n<span class=\"token prefix unchanged\"> </span>   }\n<span class=\"token prefix unchanged\"> </span> }\n</span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span> // OGP画像用に少し大きめで高品質な画像を取得\n<span class=\"token prefix unchanged\"> </span> query {\n<span class=\"token prefix unchanged\"> </span>   images: allFile(filter: {relativePath: {regex: \"/^thumbnail/*/\"}}) {\n<span class=\"token prefix unchanged\"> </span>     edges {\n<span class=\"token prefix unchanged\"> </span>       node {\n<span class=\"token prefix unchanged\"> </span>         childImageSharp {\n<span class=\"token prefix unchanged\"> </span>           fluid(maxWidth: 1200, quality: 90, pngQuality: 90) {\n<span class=\"token prefix unchanged\"> </span>             ...GatsbyImageSharpFluid\n<span class=\"token prefix unchanged\"> </span>           }\n<span class=\"token prefix unchanged\"> </span>         }\n<span class=\"token prefix unchanged\"> </span>       }\n<span class=\"token prefix unchanged\"> </span>     }\n<span class=\"token prefix unchanged\"> </span>   }\n<span class=\"token prefix unchanged\"> </span> }</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h2 id=\"4-画像の縦横サイズを最適化する\" style=\"position:relative;\"><a href=\"#4-%E7%94%BB%E5%83%8F%E3%81%AE%E7%B8%A6%E6%A8%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%82%92%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%99%E3%82%8B\" aria-label=\"4 画像の縦横サイズを最適化する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 画像の縦横サイズを最適化する</h2>\n<p>画像のサイズが大きいとビルド時間は指数関数的に増加します。\nそのため、表示幅に併せて画像の縦横比を縮小しましょう。\n例えば記事中で最大800pxで表示するような場合、Retina対応も考慮すると最大幅は800px * 2 = 1600pxで十分です。\nそのためビルド前に1600pxより幅が大きい画像は全て1600pxに縮小しましょう。\n<a href=\"https://github.com/lovell/sharp\">Sharp</a>というライブラリを使えばできます。\n以下のようなスクリプトを定義して、package.jsonに<code class=\"language-text\">optimizeImages</code>のようなnpm scriptsを定義しましょう。</p>\n<div class=\"gatsby-code-title\">scripts/optimize-images.js(画像縦横サイズ最適化スクリプト)</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> sharp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">sharp</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> glob <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">glob</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">fs</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 最適化したい画像のパスを正規表現で指定</span>\n<span class=\"token keyword\">const</span> matches <span class=\"token operator\">=</span> glob<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">src/pages/**/*.{png,jpg,jpeg}</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Retinaを考慮し2倍にする</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">MAX_WIDTH</span> <span class=\"token operator\">=</span> <span class=\"token number\">800</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span>\n\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>\n  matches<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">match</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> <span class=\"token function\">sharp</span><span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> info <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> stream<span class=\"token punctuation\">.</span><span class=\"token function\">metadata</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>width <span class=\"token operator\">&lt;=</span> <span class=\"token constant\">MAX_WIDTH</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 画像幅をMAX_WIDTHまで縮小して上書き</span>\n    <span class=\"token keyword\">const</span> outputBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> stream<span class=\"token punctuation\">.</span><span class=\"token function\">resize</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MAX_WIDTH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">,</span> outputBuffer<span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">success resize markdown image. </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>info<span class=\"token punctuation\">.</span>width<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">MAX_WIDTH</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>match<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'Success'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<div class=\"gatsby-code-title\">package.jsonのnpm</div>\n<div class=\"gatsby-highlight\" data-language=\"jsonscripts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsonscripts line-numbers\"><code class=\"language-jsonscripts\">  &quot;scripts&quot;: {\n    // 中略\n    &quot;optimizeImages&quot;: &quot;node ./scripts/optimize-images.js&quot;,\n    // 中略\n  }</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>こうすれば<code class=\"language-text\">npm run optimizeImages</code>で画像の縦横サイズを最適化できます。</p>\n<h2 id=\"5-画像のファイルサイズを圧縮する\" style=\"position:relative;\"><a href=\"#5-%E7%94%BB%E5%83%8F%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%B5%E3%82%A4%E3%82%BA%E3%82%92%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B\" aria-label=\"5 画像のファイルサイズを圧縮する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 画像のファイルサイズを圧縮する</h2>\n<p>写真は無駄に高画質でファイルサイズが大きくなりがちです。\nこの場合、<a href=\"https://github.com/imagemin/imagemin\">imagemin</a>を使って画像のファイルサイズを圧縮しましょう。\n以下のようなスクリプトを定義して、package.jsonに<code class=\"language-text\">compressImages</code>のようなnpm scriptsを定義しましょう。\njpegは<a href=\"https://www.npmjs.com/package/imagemin-mozjpeg\">imagemin-mozjpeg</a>、pngは<a href=\"https://www.npmjs.com/package/imagemin-pngquant\">imagemin-pngquant</a>を使えば画質をそれほど落とすことなく圧縮できます。</p>\n<div class=\"gatsby-code-title\">scripts/compress-images(画像ファイルサイズ最適化スクリプト)</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> glob <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">glob</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">fs</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> imagemin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'imagemin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> imageminMozjpeg <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'imagemin-mozjpeg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> imageminPngquant <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'imagemin-pngquant'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addSizeInfo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">filePath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">statSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">size</span><span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">,</span>\n    filePath\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> matchesThumbnail <span class=\"token operator\">=</span> glob<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">src/images/thumbnail/**/*.{png,jpg,jpeg}</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> matchesPage <span class=\"token operator\">=</span> glob<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">src/pages/**/*.{png,jpg,jpeg}</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>matchesThumbnail<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>matchesPage<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>addSizeInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">factor</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span> factor<span class=\"token punctuation\">.</span>filePath<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> fileDir <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> fileExt <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'.png'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>fileExt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token keyword\">await</span> <span class=\"token function\">imagemin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>filePath<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> fileDir<span class=\"token punctuation\">,</span> <span class=\"token comment\">// overwrite</span>\n        <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token function\">imageminPngquant</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> compressedSize <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">statSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>    \n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>factor<span class=\"token punctuation\">.</span>size<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>compressedSize<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>filePath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'.jpg'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'.jpeg'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>fileExt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n      <span class=\"token keyword\">await</span> <span class=\"token function\">imagemin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>filePath<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> fileDir<span class=\"token punctuation\">,</span> <span class=\"token comment\">// overwrite</span>\n        <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token function\">imageminMozjpeg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> compressedSize <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">statSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>    \n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>factor<span class=\"token punctuation\">.</span>size<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>compressedSize<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>filePath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Can't optimize\"</span><span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<div class=\"gatsby-code-title\">package.jsonのnpm</div>\n<div class=\"gatsby-highlight\" data-language=\"jsonscripts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsonscripts line-numbers\"><code class=\"language-jsonscripts\">  &quot;scripts&quot;: {\n    // 中略\n    &quot;compressImages&quot;: &quot;node ./scripts/compress-images.js&quot;,\n    // 中略\n  }</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>こうすれば<code class=\"language-text\">npm run compressImages</code>で画像のファイルサイズを圧縮できます。</p>\n<h2 id=\"6-生成する画像をシンプル低クオリティにする\" style=\"position:relative;\"><a href=\"#6-%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B%E7%94%BB%E5%83%8F%E3%82%92%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E4%BD%8E%E3%82%AF%E3%82%AA%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AB%E3%81%99%E3%82%8B\" aria-label=\"6 生成する画像をシンプル低クオリティにする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 生成する画像をシンプル＆低クオリティにする</h2>\n<p><a href=\"https://www.gatsbyjs.org/packages/gatsby-image/#gatsby-transformer-sharp\">gatsby-image</a>では、生成する画像の種類を以下のように選択できます。\nレスポンシブ対応する場合<code class=\"language-text\">Fluid</code>系の画像の指定が必須ですが、\n<code class=\"language-text\">GatsbyImageSharpFluid_tracedSVG</code>や<code class=\"language-text\">GatsbyImageSharpFluid_withWebp</code>はSVGやWebpなどの画像も併せて生成することになるので、ビルド時間は長くなってしまいます。　特にこだわりがなければ一番シンプルな<code class=\"language-text\">GatsbyImageSharpFluid</code>を選択するとビルド時間が短縮できるでしょう。</p>\n<ul>\n<li><code class=\"language-text\">GatsbyImageSharpFixed</code> ← Fixed系はレスポンシブだと使えない</li>\n<li><code class=\"language-text\">GatsbyImageSharpFixed_noBase64</code></li>\n<li><code class=\"language-text\">GatsbyImageSharpFixed_tracedSVG</code></li>\n<li><code class=\"language-text\">GatsbyImageSharpFixed_withWebp</code></li>\n<li><code class=\"language-text\">GatsbyImageSharpFixed_withWebp_noBase64</code></li>\n<li><code class=\"language-text\">GatsbyImageSharpFixed_withWebp_tracedSVG</code></li>\n<li><code class=\"language-text\">GatsbyImageSharpFluid</code> ← シンプル</li>\n<li><code class=\"language-text\">GatsbyImageSharpFluid_noBase64</code> ← 最初に表示するBase64のぼかし画像がないが、それでいいなら一番シンプル</li>\n<li><code class=\"language-text\">GatsbyImageSharpFluid_tracedSVG</code> ← SVGを生成するのでビルド時間が長くなる</li>\n<li><code class=\"language-text\">GatsbyImageSharpFluid_withWebp</code> ← Webpを生成するのでビルド時間が長くなる</li>\n<li><code class=\"language-text\">GatsbyImageSharpFluid_withWebp_noBase64</code></li>\n<li><code class=\"language-text\">GatsbyImageSharpFluid_withWebp_tracedSVG</code> &#x3C;-SVGとWebpを生成するのでビルド時間がかなり長くなる</li>\n<li><code class=\"language-text\">GatsbyImageSharpFluidLimitPresentationSize</code></li>\n</ul>\n<p>また、クエリで生成画像のクオリティを指定できます。\nクオリティある程度妥協できるならば、低い値を指定することでビルド時間を短縮できます。</p>\n<div class=\"gatsby-code-title\">クオリティを下げることでビルド時間を短縮する</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\">  <span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token attr-name\">images</span><span class=\"token punctuation\">:</span> <span class=\"token property-query\">allFile</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token attr-name\">relativePath</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token attr-name\">regex</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/^thumbnail/*/\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token object\">edges</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token object\">node</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token object\">childImageSharp</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property-query\">fluid</span><span class=\"token punctuation\">(</span>\n              <span class=\"token attr-name\">maxWidth</span><span class=\"token punctuation\">:</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">              <span class=\"token attr-name\">quality</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">              <span class=\"token attr-name\">pngQuality</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span></span>            <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token operator\">...</span><span class=\"token fragment function\">GatsbyImageSharpFluid</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h2 id=\"7-netlify-plugin-gatsby-cacheを使う\" style=\"position:relative;\"><a href=\"#7-netlify-plugin-gatsby-cache%E3%82%92%E4%BD%BF%E3%81%86\" aria-label=\"7 netlify plugin gatsby cacheを使う permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. netlify-plugin-gatsby-cacheを使う</h2>\n<p>Netlifyでビルド＆ホストしているなら、<a href=\"https://github.com/jlengstorf/netlify-plugin-gatsby-cache\">netlify-plugin-gatsby-cache</a>が使えます。\nこれは前回ビルド時のキャッシュを用いてビルド時間を短縮するためのNetlifyプラグインです。\n<strong>自分は、コレを導入したおかげで、記事を追加するだけならビルド時間が2分程度で済むようになりました。</strong></p>\n<p>以下のように<code class=\"language-text\">netlify.toml</code>を設定し、package.jsonのnpm scriptで<code class=\"language-text\">gatsby build</code>にちょっとした引数を指定するだけキャッシュが有効になります。</p>\n<div class=\"gatsby-code-title\">netlify.toml(Netlifyの設定ファイル)</div>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-toml line-numbers\"><code class=\"language-toml\">// 中略\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token table class-name\">plugins</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key property\">package</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"netlify-plugin-gatsby-cache\"</span>\n// 中略</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<div class=\"gatsby-code-title\">package.jsonのnpm</div>\n<div class=\"gatsby-highlight\" data-language=\"jsonscripts\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsonscripts line-numbers\"><code class=\"language-jsonscripts\">  &quot;scripts&quot;: {\n    // 中略\n    &quot;build&quot;: &quot;GATSBY_EXPERIMENTAL_PAGE_BUILD_ON_DATA_CHANGES=true gatsby-parallel-runner build --log-pages&quot;,\n    // 中略\n  }\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>ただ、こちらはキャッシュを使ったビルド時間短縮方法ですので、初回のビルドは短縮されません。\nNetlifyのビルドでタイムアウトを解決したい場合の根本的な解決策にはならないので、気をつけてください。\nキャッシュでビルド時間がタイムアウト時間以内に収まっていたとしても、ドラスティックな機能改修でほとんどキャッシュが効かない場合や、なんらかの不具合でキャッシュなしでクリーンビルドが必要になった場合、結局タイムアウトが発生してしまいます。\nこの場合は先にあげた1～6のTipsを実施して、根本的なビルド時間の短縮を図ってください。</p>\n<h2 id=\"番外編1-circle-ciでビルドしてnetlifyにデプロイする\" style=\"position:relative;\"><a href=\"#%E7%95%AA%E5%A4%96%E7%B7%A81-circle-ci%E3%81%A7%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6netlify%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B\" aria-label=\"番外編1 circle ciでビルドしてnetlifyにデプロイする permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>番外編1: Circle CIでビルドしてNetlifyにデプロイする</h2>\n<p>本線からは少し脱線しますが、どうしてもNetlifyでタイムアウト問題が克服できない or ビルド時間が安定しない時はCircleCIを使ってビルドすると良いです。Netlify側でコケても、CircleCIでビルド検証ができるようになります。\nCircleCIはタイムアウトになる心配もないし、Netlifyより少しビルドが早くなります。</p>\n<p>開発用依存ライブラリに<a href=\"https://github.com/netlify/cli\">netlify-cli</a>して以下のスクリプトを定義しましょう。\nなるべくキャッシュして次回以降のビルド時間を短縮するようにしています。\nビルドが終わったら、netlify-cliでビルド資産をNetlifyにdeployしています。\nmasterブランチの場合は<code class=\"language-text\">--prod</code>を指定して本チャンdeployになるようにしています。\ndeploy時は、Netlifyのトークンが必要になるので、事前にNetlifyでトークンを発行して、CircleCIの環境変数に設定してあげましょう。</p>\n<div class=\"gatsby-code-title\">.circleci/config.yml(CircleCIの設定ファイル)</div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2.1</span>\n<span class=\"token key atrule\">executors</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">node-executor</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> circleci/node<span class=\"token punctuation\">:</span><span class=\"token number\">12</span>\n<span class=\"token key atrule\">commands</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">gatsby-build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> checkout\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># when lock file changes, use increasingly general patterns to restore cache</span>\n            <span class=\"token punctuation\">-</span> node<span class=\"token punctuation\">-</span>v1<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Branch <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"package<span class=\"token punctuation\">-</span>lock.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">-</span> node<span class=\"token punctuation\">-</span>v1<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Branch <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>\n            <span class=\"token punctuation\">-</span> node<span class=\"token punctuation\">-</span>v1<span class=\"token punctuation\">-</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ~/usr/local/lib/node_modules  <span class=\"token comment\"># location depends on npm version</span>\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">-</span>v1<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Branch <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> checksum \"package<span class=\"token punctuation\">-</span>lock.json\" <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> gatsby<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>cache<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Branch <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">-</span> gatsby<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>cache<span class=\"token punctuation\">-</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> GATSBY_CPU_COUNT=2 NODE_OPTIONS=\"<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>max<span class=\"token punctuation\">-</span>old<span class=\"token punctuation\">-</span>space<span class=\"token punctuation\">-</span>size=8192\" npm run build\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> gatsby<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>cache<span class=\"token punctuation\">-</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> .Branch <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./public\n<span class=\"token key atrule\">workflows</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">build-deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">ignore</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> master\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> master\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">executor</span><span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">-</span>executor\n    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> ~/repo\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> gatsby<span class=\"token punctuation\">-</span>build\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Netlify Deploy\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ./node_modules/.bin/netlify deploy <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>dir=public <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>message \"deploy preview from $CIRCLE_BRANCH\" <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>auth $NETLIFY_ACCESS_TOKEN\n  <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">executor</span><span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">-</span>executor\n    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> ~/repo\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> gatsby<span class=\"token punctuation\">-</span>build\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Netlify Deploy\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ./node_modules/.bin/netlify deploy <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>prod <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>dir=public <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>message \"deploy from $CIRCLE_BRANCH\" <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>auth $NETLIFY_ACCESS_TOKEN</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"番外編2効果がみられなかった取り組み\" style=\"position:relative;\"><a href=\"#%E7%95%AA%E5%A4%96%E7%B7%A82%E5%8A%B9%E6%9E%9C%E3%81%8C%E3%81%BF%E3%82%89%E3%82%8C%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E5%8F%96%E3%82%8A%E7%B5%84%E3%81%BF\" aria-label=\"番外編2効果がみられなかった取り組み permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>番外編2:効果がみられなかった取り組み</h2>\n<p>ビルド時間短縮のためアレコレと試しましたが、効果がなかったものもあります。</p>\n<h3 id=\"画像取得系staticqueryを集約する\" style=\"position:relative;\"><a href=\"#%E7%94%BB%E5%83%8F%E5%8F%96%E5%BE%97%E7%B3%BBstaticquery%E3%82%92%E9%9B%86%E7%B4%84%E3%81%99%E3%82%8B\" aria-label=\"画像取得系staticqueryを集約する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>画像取得系StaticQueryを集約する</h3>\n<p>複数箇所に散らばっていStaticQueryを１つコンポーネントに集約してみました。\n確かにクエリの実行回数は減りましたが、画像生成枚数は変わらないのでビルド時間は短縮されませんでした。</p>\n<h3 id=\"クエリをgatsby-nodejsに集約する\" style=\"position:relative;\"><a href=\"#%E3%82%AF%E3%82%A8%E3%83%AA%E3%82%92gatsby-nodejs%E3%81%AB%E9%9B%86%E7%B4%84%E3%81%99%E3%82%8B\" aria-label=\"クエリをgatsby nodejsに集約する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>クエリをgatsby-node.jsに集約する</h3>\n<p>上記と似ていますが、すべてのクエリを<code class=\"language-text\">gatsby-node.js</code>で発行して、クエリの結果をContextで各ページのコンポーネントに渡すようにしても、ビルド時間は短縮されませんでした。</p>\n<p>また<code class=\"language-text\">gatsby-node.js</code>にクエリを集約するのは、以下のような弊害もあるため、あまりオススメしません。</p>\n<ul>\n<li><code class=\"language-text\">gatsby develop</code>時に<code class=\"language-text\">gatsby-node.js</code>を修正してもホットリロードされない</li>\n<li>ページのコンポーネントで使うデータを取得するためのクエリが、<code class=\"language-text\">gatsby-node.js</code>という離れた場所にあるので管理しづらい</li>\n<li>クエリでGraphQLのフラグメントが使えない\n<ul>\n<li>gatsby-imagesのGatsbyImageSharpFluidなどが使えないので、以下のようにフラグメントに定義されてる全プロパティを書き出す必要があります。</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-code-title\">gatsby-node.js中で画像取得クエリを書く場合はフラグメントが使えない</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">allFile</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token attr-name\">relativePath</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token attr-name\">regex</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/^thumbnail/*/\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">edges</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token object\">node</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token object\">childImageSharp</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token object\">fluid</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">            <span class=\"token property\">base64</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token property\">aspectRatio</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token property\">src</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token property\">srcSet</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token property\">sizes</span></span>          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Gatsbyは割とgatsby-imageとの戦いで、画像の取り扱いが面倒くさく、ビルド時間も長くなりがちですが、\n今回紹介したようなTipsを使えば、ある程度ビルド時間は短縮できます。\nただ、これらTipsを実施してもビルド時間が短縮できない場合は、いっそのことgatsby-imageを使うのをやめて、\n他の画像ホスティングサービスを使うのもアリなんじゃないかと思います🍅</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://www.netlify.com/blog/2020/02/25/gatsby-build-speed-improvements-with-parallel-image-processing/\">Improve Gatsby Build Speeds With Parallel Image Processing</a></li>\n<li><a href=\"https://dev.to/biilmann/open-source-parallel-processing-for-gatsby-270d\">Open source parallel processing for Gatsby - DEV Community 👩‍💻👨‍💻</a></li>\n<li><a href=\"https://www.gatsbyjs.org/docs/preoptimizing-images/\">Preoptimizing Your Images | GatsbyJS</a></li>\n<li><a href=\"https://web.dev/use-imagemin-to-compress-images/\">Use Imagemin to compress images</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-sharp\">gatsby-plugin-sharp | GatsbyJS</a></li>\n<li><a href=\"https://www.netlify.com/blog/2020/04/23/enable-gatsby-incremental-builds-on-netlify/\">Enable Gatsby Incremental Builds on Netlify</a></li>\n<li><a href=\"https://oioannou.com/build-on-circleci-deploy-netlify\">Building gatsby on CircleCi and deploying on Netlify — Orestis Ioannou</a></li>\n<li><a href=\"https://web.dev/use-imagemin-to-compress-images/\">Use Imagemin to compress images</a></li>\n<li><a href=\"https://www.netlify.com/blog/2020/06/11/5-optimizations-for-faster-gatsby-builds/\">5 Optimizations to Get Faster Gatsby Builds Today</a></li>\n</ul>","excerpt":"なにこれ 自分のブログ(Gatsby製)のビルドが遅すぎてNetlifyでタイムアウトしてしまうので、ビルドチューニングをしました。\n15分以上かかっていたビルドが7分以下になり50%短縮できたので、その時の知見をまとめます。\n割と地味な作業が多いですが、Gatsby…","frontmatter":{"slug":"/optimizations-for-faster-gatsby-builds","title":"Gatsbyビルドチューニング ビルド時間を15分から7分に短縮するためのTips 7選","date":"2020-06-22T08:30:00.000+09:00","tags":["Gatsby","gatsby-image","gatsby-image-sharp","Netlify","CircleCI"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2020/06/optimizations-for-faster-gatsby-builds.png","category":null}},{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p><a href=\"https://github.com/plotly/react-cytoscapejs\">react-cytoscape</a>のようなwindowオブジェクトを前提としたライブラリをGatsbyで使おうとすると、<code class=\"language-text\">gatsby develop</code>のときは正常動作するにもかかわらず、ビルド時にだけ<code class=\"language-text\">window is not defined</code>エラーがでます。今回はその対処法を備忘録として残しておきます。</p>\n<h2 id=\"原因と対処法\" style=\"position:relative;\"><a href=\"#%E5%8E%9F%E5%9B%A0%E3%81%A8%E5%AF%BE%E5%87%A6%E6%B3%95\" aria-label=\"原因と対処法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>原因と対処法</h2>\n<p>Gatsbyビルド時は、<code class=\"language-text\">window</code>や<code class=\"language-text\">document</code>といったブラウザのグローバルオブジェクトを参照しているとエラーになります。\nこの場合、それらがundefinedかチェックが必要です。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token comment\">// (Before) 以下でビルド時にエラーが出る場合は...</span>\n<span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span> \n\n<span class=\"token comment\">// (After 1) このようにwindowオブジェクトの存在チェックをすることでエラーを免れます</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">undefined</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// (After 2) このような形でもOKです</span>\n<span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">undefined</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">?</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br />\n<p>またwebpackの設定で、ビルドエラーになるライブラリをダミーに置き換えることで、エラーを免れます。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> stage<span class=\"token punctuation\">,</span> loaders<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>stage <span class=\"token operator\">===</span> <span class=\"token string\">'build-html'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    actions<span class=\"token punctuation\">.</span><span class=\"token function\">setWebpackConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">react-cytoscapejs</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> loaders<span class=\"token punctuation\">.</span><span class=\"token function\">null</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br />\n<p>さらに、そのライブラリを使った処理をReactコンポーネントに記述している場合は、<code class=\"language-text\">componentDidMount</code>か<code class=\"language-text\">useEffect</code>に移しましょう。そうすることで、その処理がブラウザでのみ実行されるようになるのでビルド時のエラーを免れます。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> CytoscapeComponent <span class=\"token keyword\">from</span> <span class=\"token string\">'react-cytoscapejs'</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostRelationSection</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">/*--中略--*/</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> posts<span class=\"token punctuation\">,</span> allImage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props\n    <span class=\"token keyword\">const</span> nodes <span class=\"token operator\">=</span> <span class=\"token function\">createPostNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> posts<span class=\"token punctuation\">,</span> allImage <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    nodes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CYTOSCAPE_ZOOM_UP_ELEMENT</span><span class=\"token punctuation\">)</span>\n    nodes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CYTOSCAPE_ZOOM_DOWN_ELEMENT</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> edges <span class=\"token operator\">=</span> <span class=\"token function\">createPostEdges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>posts<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> cytoscapeElements <span class=\"token operator\">=</span> CytoscapeComponent<span class=\"token punctuation\">.</span><span class=\"token function\">normalizeElements</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> nodes<span class=\"token punctuation\">,</span> edges <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> cytoscapeElements <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/*--中略--*/</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/docs/debugging-html-builds/\">Debugging HTML Builds | GatsbyJS</a></li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/issues/309\">Window is not defiend · Issue #309 · gatsbyjs/gatsby</a></li>\n</ul>","excerpt":"なにこれ react-cytoscapeのようなwindowオブジェクトを前提としたライブラリをGatsbyで使おうとすると、のときは正常動作するにもかかわらず、ビルド時にだけエラーがでます。今回はその対処法を備忘録として残しておきます。 原因と対処法 Gatsby…","frontmatter":{"slug":"/error-about-window-is-not-available-during-server-side-rendering-gatsby","title":"Gatsbyビルドエラー「window is not defined」への対処法","date":"2020-05-23T09:00:00.000-07:00","tags":["Gatsby"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2020/05/error-about-window-is-not-available-during-server-side-rendering-gatsby.png","category":null}},{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>自分専用のRSSリーダーを<a href=\"https://gatsbyjs.org\">Gatsby</a> + <a href=\"https://netlify.com\">Netlify</a> + <a href=\"https://zapier.com/\">Zapier</a>を使って作りました。Gatsbyビルド時にRSSとOGPを取得して、Webサイトに表示しています。\n今回はこのWebサイトのビルドの仕組みと、GatsbyビルドでRSS+OGPを取得する方法をご紹介します。</p>\n<p>サイトはコチラ↓</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://favorite-blogs.netlify.com//\" data-iframely-url=\"//cdn.iframe.ly/api/iframe?url=https%3A%2F%2Ffavorite-blogs.netlify.com&key=0658bf78be97cafcf2b0b9f96c1270ee\"></a></div></div>\n<br/>\n<p>ソースはコチラ↓</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://github.com/Takumon/blog-rss\" data-iframely-url=\"//cdn.iframe.ly/B8twzEh\"></a></div></div>\n<br/>\n<h2 id=\"ビルドの仕組み\" style=\"position:relative;\"><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\" aria-label=\"ビルドの仕組み permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ビルドの仕組み</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAABcRAAAXEQHKJvM/AAACqklEQVR42pWUe1PTQBTF+90dv4Azjo5vdKjFAUqRAqWFNmmem9c22Tz6wlqoVIFieZXyyHG2FUVksM6cPzK7+8vZ3HtuEnCVW4orCph2oORb+YWvwvKxUQTTUZH/Ppm4C5YRkF2jrMy8Ed4966pFNL2YShPCCnz1KKwJ7zecJbLHdtDwUJkcDtQ9GsnTtjXrVUub2AwwoTMXU07qrdKcnH6a2TZ30PQndR7DR9VNQSin3qY+aW3u/F/wYdR0aVj1Gm3SRYP9E75uBi+YNmg2IsnqEHpcb99bMN8AI/DJ9ao6sMRdQ+oxCy03bji/tyoyfA2eMm57Ap6KwjRKsygkYZfANIRkYJVruSzNzHeFla64yhcrMj/p67tSbmCJCMgIrtFYylzKi1CXULWxkMSrxwhI37f09Ozn4vKOsh7XKzEto+agRreK2b4hoOkiNBOou6dVN1hJn/km2jXk0ki+gFI40YtG6vXQUa4Y6Ttacy079M3Y5eb82kwfwQ23Y8iLH1Jy8iWa/pUpxLYIR2rlMvnnjy6pNKTKmWdc2OVz37p0tbgi8/z6ZOxMv1DS2e1tGTLPsKfywoTGiWc28mvfibgl5BqlfF9dP/UIN6QS17Wzdxi5W45+wEzUWeypoxfrfdfclsSOLH7Txa4htwrZA1tDZMVM4/WLLIRWAoGBGkWdourA1UCKo221Z+l9SrpE7VEDNRtMRWhwZqyqDaYleDZomQMrc5h6gtx8XF5FoO8rpWND3NeEfaV4RER4o1G9qZ8hGU0/pFUspvBxJl5fhLHRI/KFIx3o0sBR9pQST9F98fR1RCYX02JT7JQyiOweKexrufPQ6hTnbkTwzsH4daU6HZQfom5f0JmhORU32an4gH/qnz+jO6dq1MaqjdBEZI8eLF5On9yCfwCSSy5+ddkwVwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/bd76523636abbba4e627962160567c6d/ba381/build-flow.webp 200w,\n/static/bd76523636abbba4e627962160567c6d/7f61c/build-flow.webp 400w,\n/static/bd76523636abbba4e627962160567c6d/d00b9/build-flow.webp 800w,\n/static/bd76523636abbba4e627962160567c6d/92f8c/build-flow.webp 1200w,\n/static/bd76523636abbba4e627962160567c6d/fad48/build-flow.webp 1600w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/bd76523636abbba4e627962160567c6d/772e8/build-flow.png 200w,\n/static/bd76523636abbba4e627962160567c6d/e17e5/build-flow.png 400w,\n/static/bd76523636abbba4e627962160567c6d/5a190/build-flow.png 800w,\n/static/bd76523636abbba4e627962160567c6d/c1b63/build-flow.png 1200w,\n/static/bd76523636abbba4e627962160567c6d/29007/build-flow.png 1600w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/bd76523636abbba4e627962160567c6d/5a190/build-flow.png\"\n            alt=\"build flow\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>以下時系列で説明します。</p>\n<ul>\n<li>Zapier\n<ul>\n<li>ジョブで定義したRSSを監視</li>\n<li>RSSに更新があったらNetlifyビルドをトリガー</li>\n</ul>\n</li>\n<li>Netlify\n<ul>\n<li>ビルドでGitHubからGatsbyプロジェクトのリポジトリをフェッチ</li>\n<li>Gatsbyプロジェクトのビルドを実行</li>\n<li>Gatsbyプロジェクトのビルドの中で、設定ファイルに定義したRSSをフェッチ</li>\n<li>ビルドが終わったらCDNにホスティング</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"netlifyとgithubの連携\" style=\"position:relative;\"><a href=\"#netlify%E3%81%A8github%E3%81%AE%E9%80%A3%E6%90%BA\" aria-label=\"netlifyとgithubの連携 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NetlifyとGitHubの連携</h3>\n<p>Netlify上でGitHubリポジトリをビルド＆ホストできるようにしておきます。\n連携はNelityのGUIで簡単にできます。</p>\n<h3 id=\"zapierとnetlifyの連携\" style=\"position:relative;\"><a href=\"#zapier%E3%81%A8netlify%E3%81%AE%E9%80%A3%E6%90%BA\" aria-label=\"zapierとnetlifyの連携 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ZapierとNetlifyの連携</h3>\n<p>RSSリーダーは「RSSが更新されたらビルドをトリガーする」ような仕組みが必要です。この仕組みはNetlifyとZapierで実現できます。\nZapierはいろんなサービスやアプリを連携させて自動化できるWebサービスで、Netlifyにも対応しています。\nZapierの画面上で、監視したいRSSをポチポチ登録すると「RSSが更新されたらNetlifyのビルドをトリガーする」が簡単に実現できます。</p>\n<h2 id=\"rss--ogp取得\" style=\"position:relative;\"><a href=\"#rss--ogp%E5%8F%96%E5%BE%97\" aria-label=\"rss  ogp取得 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RSS + OGP取得</h2>\n<p>さてビルドの仕組みを整えたので、次はGatsbyのビルドでRSSを取得する方法について説明します。</p>\n<p>どのRSSを引っ張ってくるかは、GitHubリポジトリに設定ファイルにて定義します（<a href=\"https://github.com/Takumon/blog-rss/blob/master/favorite-blog-rss.js\">実際の設定ファイル</a>）。\nただコレ、ZapierのジョブのRSS定義と二重管理になるのが難点です。Zapierのタスクがyamlで書けるようになったら一元管理できるかもですが...</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> striptags <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'striptags'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> cheerio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cheerio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"crypto\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Parser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rss-parser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> parser <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Parser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'User-Agent'</span><span class=\"token operator\">:</span> <span class=\"token string\">'something different'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG</span> <span class=\"token operator\">=</span> <span class=\"token string\">'blog'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG_POST</span> <span class=\"token operator\">=</span> <span class=\"token string\">'blogPost'</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// RSSのような外部リソースを</span>\n<span class=\"token comment\">// GatsbyでGraphQLのデータとして扱うためには</span>\n<span class=\"token comment\">// sorceNodeで処理する</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sourceNodes</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> createNodeId<span class=\"token punctuation\">,</span> store<span class=\"token punctuation\">,</span> cache <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> feeds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token comment\">// 設定ファイルかなにかしらの方法でRSSのURLを読み込む</span>\n  <span class=\"token keyword\">const</span> blogUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'rss-url-1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'rss-url-2'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> blogUrl <span class=\"token keyword\">of</span> blogUrls<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  \n    <span class=\"token comment\">// rss-parserでRSS情報を取得する</span>\n    <span class=\"token keyword\">const</span> feed <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> parser<span class=\"token punctuation\">.</span><span class=\"token function\">parseURL</span><span class=\"token punctuation\">(</span>blogUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">feed</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>feed<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> feed<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> item<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">excerpt</span><span class=\"token operator\">:</span> <span class=\"token function\">excerpt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> item<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">pubDate</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>pubDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">link</span> <span class=\"token operator\">:</span> item<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    feeds<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>feed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n\n  <span class=\"token comment\">// ブログごとにノード生成</span>\n  feeds\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">feed</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> feed<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> feed<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">link</span><span class=\"token operator\">:</span> feed<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">lastBuildDate</span><span class=\"token operator\">:</span> feed<span class=\"token punctuation\">.</span>lastBuildDate<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">b</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> contentDigest <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">md5</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      \n      actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>b<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token function\">createNodeId</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">INTERNAL_TYPE_BLOG</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>b<span class=\"token punctuation\">.</span>link<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">parent</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">__SOURCE__</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">internal</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG</span><span class=\"token punctuation\">,</span>\n          contentDigest<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// RSSに加えて、OGPを取得</span>\n  <span class=\"token keyword\">const</span> rssPosts <span class=\"token operator\">=</span> feeds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">feed</span> <span class=\"token operator\">=></span> feed<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span>b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>a<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rssPostsWithImageUrl <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Promise.allでやると503になるのでfor文を使う</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> p <span class=\"token keyword\">of</span> rssPosts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> pWithImageUrl <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'User-Agent'</span><span class=\"token operator\">:</span> <span class=\"token string\">'something different'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">// 取得したHTMLからOGPを取得</span>\n      <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">let</span> imageUrl<span class=\"token punctuation\">;</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'head meta'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i<span class=\"token punctuation\">,</span> el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> property <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'property'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>property <span class=\"token operator\">===</span> <span class=\"token string\">'og:image'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          imageUrl <span class=\"token operator\">=</span> content\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 記事情報にOGPのURLを追加</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>p<span class=\"token punctuation\">,</span>\n        imageUrl<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    rssPostsWithImageUrl<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>pWithImageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n\n  <span class=\"token comment\">// OGP画像のノードを生成</span>\n  <span class=\"token comment\">// 重複を考慮してユニークにしてから処理する</span>\n  <span class=\"token keyword\">const</span> imageUrls <span class=\"token operator\">=</span> <span class=\"token function\">_uniq</span><span class=\"token punctuation\">(</span>rssPostsWithImageUrl<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>imageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>imageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>imageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">imageUrl</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> fileNode <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createRemoteFileNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n      cache<span class=\"token punctuation\">,</span>\n      store<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">createNode</span><span class=\"token operator\">:</span> actions<span class=\"token punctuation\">.</span>createNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">createNodeId</span><span class=\"token operator\">:</span> createNodeId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'ThumbnailImage'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'link'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> fileNode<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n  <span class=\"token comment\">// ブログ記事ごとのノード生成</span>\n  rssPostsWithImageUrl<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> contentDigest <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">md5</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">const</span> excerpt <span class=\"token operator\">=</span> \n    actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>p<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token function\">createNodeId</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">INTERNAL_TYPE_BLOG_POST</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>p<span class=\"token punctuation\">.</span>link<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">parent</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">__SOURCE__</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">internal</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG_POST</span><span class=\"token punctuation\">,</span>\n        contentDigest<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// 記事要約は記事本文から抽出</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">excerpt</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">html<span class=\"token punctuation\">,</span> maxLength</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rowText <span class=\"token operator\">=</span> <span class=\"token function\">striptags</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;pre>'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">&lt;pre[\\s\\S]+?>[\\s\\S]+?&lt;\\/pre></span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\n</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"> </span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> rowText<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> maxLength\n    <span class=\"token operator\">?</span> rowText<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> maxLength<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'...'</span>\n    <span class=\"token operator\">:</span> rowText<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>OGP画像をGatsbyで扱う処理は今も参考にしてみてください。</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"padding-bottom: 52.5%; padding-top: 120px;\"><a href=\"https://takumon.com/gatsby-image-of-remote-in-building-by-using-create-remote-file-node\" data-iframely-url=\"//cdn.iframe.ly/r1GTW3Y\"></a></div></div>\n<h3 id=\"リソース取得は間隔を置かないと503になる\" style=\"position:relative;\"><a href=\"#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E5%8F%96%E5%BE%97%E3%81%AF%E9%96%93%E9%9A%94%E3%82%92%E7%BD%AE%E3%81%8B%E3%81%AA%E3%81%84%E3%81%A8503%E3%81%AB%E3%81%AA%E3%82%8B\" aria-label=\"リソース取得は間隔を置かないと503になる permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>リソース取得は間隔を置かないと503になる</h3>\n<p>ビルド時にRSSやらOGPやらを引っ張ってくるために、大量のリクエストを発行しますが、サイトによっては時間当たりのリクエスト上限に引っかかって503エラーになることがあります。\n対処法としては、<code class=\"language-text\">Promise.all</code>で一度にリクエストを投げずに、for文でリクエスト1つずつawaitしながら投げて、適度に間隔を開けるのが良いと思います。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>RSSリーダーのようなものをSPAだけで作ろうとすると、フロント側の高負荷処理で画面描画が遅くなってしまいますが、\nGatsbyを使えばビルド時に重い処理を流せるので、パフォーマンスの向上が期待できます。\nまた今回のように、NetlifyやZapierなど他サービスと連携することで、作れる静的サイトの幅も広がります。\nSPA(Single Page Application)でこのような静的サイトを作っている方は一度Gatsbyを導入してみてはいかがでしょうか🍅</p>","excerpt":"なにこれ 自分専用のRSSリーダーをGatsby + Netlify + Zapierを使って作りました。Gatsbyビルド時にRSSとOGPを取得して、Webサイトに表示しています。\n今回はこのWebサイトのビルドの仕組みと、GatsbyビルドでRSS+OGP…","frontmatter":{"slug":"/gatsby-rss-reader-with-netlify-and-zapier","title":"Gatsby + Netlify + ZapierでRSSリーダーを作る","date":"2019-06-18T10:00:00.000-07:00","tags":["Gatsby","Netlify","Zapier","RSS","gatsby-plugin-feed"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/06/gatsby-rss-reader-with-netlify-zapier.png","category":null}},{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>Gatsbyで画像を扱う場合<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-image\">gatsby-image</a>を使うとイイ感じに最適化してくれます。\nWebサイトのリポジトリ内の画像については<code class=\"language-text\">gatsby-config.js</code>で簡単に設定できますが、<strong>今回はビルド時に動的に取得する外部画像に対して設定する方法をご紹介します。</strong></p>\n<h2 id=\"実装方法\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\" aria-label=\"実装方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実装方法</h2>\n<h3 id=\"step1-外部画像ファイルノード生成\" style=\"position:relative;\"><a href=\"#step1-%E5%A4%96%E9%83%A8%E7%94%BB%E5%83%8F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8E%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90\" aria-label=\"step1 外部画像ファイルノード生成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step1. 外部画像ファイルノード生成</h3>\n<p>Gatsbyの<a href=\"\">gatsby-source-filesystem</a>では、外部画像を扱うためのAPI(<code class=\"language-text\">createRemoteFileNode</code>)が用意されています。\nコチラを<code class=\"language-text\">gatsby-node.js</code>の<code class=\"language-text\">sourceNodes</code>で呼び出せば外部画像にgatsby-imageを適用できます。\nあと、ちょっとしたハックとして、Reactコンポーネント側で他ファイルノードと区別できるように、ノード生成時に識別子を付けましょう。これは後述する外部画像表示用コンポーネントで使うためのものです。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createRemoteFileNode <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-source-filesystem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// sourceNodesにて外部画像のファイルノードを作成する</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sourceNodes</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> createNodeId<span class=\"token punctuation\">,</span> cache<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* (中略) */</span>\n\n  <span class=\"token comment\">// ここでは外部画像のURLの配列を処理するサンプルを示す</span>\n  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>sampleImageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">sampleImageUrl</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// createRemoteFileNodeで外部の画像のファイルノードを作成する</span>\n    <span class=\"token keyword\">const</span> fileNode <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createRemoteFileNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> sampleImageUrl<span class=\"token punctuation\">,</span>\n      cache<span class=\"token punctuation\">,</span>\n      store<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">createNode</span><span class=\"token operator\">:</span> actions<span class=\"token punctuation\">.</span>createNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">createNodeId</span><span class=\"token operator\">:</span> createNodeId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 他ファイルノードと区別するための識別子を付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'SampleImage'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// メタ情報として画像のURLを付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'link'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> sampleImageUrl<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> fileNode<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* (中略) */</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h3 id=\"step2-外部画像表示用reactコンポーネント作成\" style=\"position:relative;\"><a href=\"#step2-%E5%A4%96%E9%83%A8%E7%94%BB%E5%83%8F%E8%A1%A8%E7%A4%BA%E7%94%A8react%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90\" aria-label=\"step2 外部画像表示用reactコンポーネント作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step2. 外部画像表示用Reactコンポーネント作成</h3>\n<p>外部画像のファイルノードを生成できたら、\n今度はReactコンポーネント側で、それに<code class=\"language-text\">gatsby-iamge</code>を適用して表示します。\nGraphQLのクエリで、ファイルノードを生成時に付与した識別子を使い、すべてのファイルノードから外部画像だけを抽出するようにしましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> GatsbyImage <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-image'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> StaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// OGP画像のURLを引数に取る</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> url <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>StaticQuery\n    query<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      query {\n        allFile(\n          # Gatsby Buildで付与した識別子をもとに\n          # 全ファイルからOPG画像のみ抽出\n          filter: {fields: {SampleImage: {eq: \"true\"}}}\n        ){\n          edges {\n            node {\n              childImageSharp {\n                resolutions {\n                  ...GatsbyImageSharpResolutions\n                }\n              }\n              id\n              fields {\n                # 一応メタ情報も取得する\n                SampleImage\n                link\n              }\n            }\n          }\n        }\n      }\n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\n    render<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// OGP画像リストの中から、コンポーネント引数で指定したURLの画像を抽出する</span>\n      <span class=\"token keyword\">const</span> targetEdge <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allFile<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">edge</span> <span class=\"token operator\">=></span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>link <span class=\"token operator\">===</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 画像が取得できた場合のみgatsby-imageのコンポーネントを返す</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        targetEdge <span class=\"token operator\">&amp;&amp;</span> targetEdge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>childImageSharp\n          <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GatsbyImage</span></span> <span class=\"token attr-name\">resolutions</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>targetEdge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>childImageSharp<span class=\"token punctuation\">.</span>resolutions<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n          <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h3 id=\"step3-上記で作成したコンポーネントの呼び出し\" style=\"position:relative;\"><a href=\"#step3-%E4%B8%8A%E8%A8%98%E3%81%A7%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97\" aria-label=\"step3 上記で作成したコンポーネントの呼び出し permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step3. 上記で作成したコンポーネントの呼び出し</h3>\n<p>最後に上記コンポーネントの呼び出します。以下のように外部画像のURLを指定してあげましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SampleImage</span></span> <span class=\"token attr-name\">url</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>SampleImageUrl<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<br/>\n<p>これで外部画像に<code class=\"language-text\">gatsby-image</code>を適用してイイ感じに表示できます！</p>\n<h2 id=\"例webサイトurlからogp画像を取得する場合\" style=\"position:relative;\"><a href=\"#%E4%BE%8Bweb%E3%82%B5%E3%82%A4%E3%83%88url%E3%81%8B%E3%82%89ogp%E7%94%BB%E5%83%8F%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\" aria-label=\"例webサイトurlからogp画像を取得する場合 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>例：WEBサイトURLからOGP画像を取得する場合</h2>\n<p>実用的な例として、複数のWebサイトのOGP画像を<code class=\"language-text\">gatsby-image</code>として扱う方法をご紹介します。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> cheerio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cheerio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createRemoteFileNode <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-source-filesystem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// sourceNodesにて外部画像のファイルノードを作成する</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sourceNodes</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> createNodeId<span class=\"token punctuation\">,</span> cache<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* (中略) */</span>\n\n\n  <span class=\"token comment\">// WEBサイトURLからHTMLを取得してOGPを抽出</span>\n  <span class=\"token keyword\">const</span> ogpImageUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Promise.allで処理するとリクエスト多可で503になるのでfor文で一件ずつ処理する</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> postUrl <span class=\"token keyword\">of</span> postUrls<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>postUrl<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'User-Agent'</span><span class=\"token operator\">:</span> <span class=\"token string\">'something different'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// cheerioを使ってHMTLからOGP画像URLを抽出</span>\n    <span class=\"token keyword\">let</span> ogpImageUrl<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'head meta'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i<span class=\"token punctuation\">,</span> el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> property <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'property'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>property <span class=\"token operator\">===</span> <span class=\"token string\">'og:image'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        ogpImageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>ogpImageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 取得したOGP画像URLをもとにファイルノードを生成</span>\n  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>ogpImageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">imageUrl</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> fileNode <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createRemoteFileNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n      cache<span class=\"token punctuation\">,</span>\n      store<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">createNode</span><span class=\"token operator\">:</span> actions<span class=\"token punctuation\">.</span>createNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">createNodeId</span><span class=\"token operator\">:</span> createNodeId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 他ファイルノードと区別するための識別子を付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'OgpImage'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// メタ情報として画像のURLを付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'link'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> fileNode<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>Reactのコンポーネントの定義、呼び出し側定義は<a href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\">実装方法</a>で紹介した内容とほぼ同じなので割愛します。</p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回の方法を使えば、外部から画像をかき集めてリッチなWebサイトを構築する場合でも、Gatsby側でブラウザ表示を最適化してくれて、画面表示が遅くなる心配もありません。\n是非参考にしてみてください🍅</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://www.wildsmithstudio.com/blog/remote-images-with-gatsby/\">Wrangling remote images with Gatsby</a></li>\n<li><a href=\"https://stackoverflow.com/questions/52612936/gatsby-fetching-remote-images-with-createremotefilenode\">graphql - Gatsby - fetching remote images with createRemoteFileNode - Stack Overflow</a></li>\n</ul>","excerpt":"なにこれ Gatsbyで画像を扱う場合gatsby-imageを使うとイイ感じに最適化してくれます。\nWebサイトのリポジトリ内の画像についてはで簡単に設定できますが、今回はビルド時に動的に取得する外部画像に対して設定する方法をご紹介します。 実装方法 Step…","frontmatter":{"slug":"/gatsby-image-of-remote-in-building-by-using-create-remote-file-node","title":"Gatsbyにおける外部取得画像へのgatsby-image適用方法","date":"2019-06-01T21:30:00.000-07:00","tags":["Gatsby","gatsby-image"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/06/gatsby-image-of-remote-in-building-by-using-create-remote-file-node.png","category":null}}],"latestPosts":[{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>Windowsでキーバインドをお気軽にいじれる<a href=\"https://www.autohotkey.com/\">AutoHotkey</a>の紹介です。３ヶ月使ってみて色々な設定を試した結果、その中でも特に便利だと感じたマウススクロールと修飾キーの組合せについてご紹介します。</p>\n<h2 id=\"autohotkeyとは\" style=\"position:relative;\"><a href=\"#autohotkey%E3%81%A8%E3%81%AF\" aria-label=\"autohotkeyとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AutoHotkeyとは</h2>\n<p>Windows版で提供されているソフトウェアで、専用のプログラミング言語でキーバインドを定義すれば、任意のキー入力に対してスクリプトを実行できます。既存のキーに別のキーの割当てたり、複雑なショートカットコマンドの割当が可能です。</p>\n<h3 id=\"良い部分\" style=\"position:relative;\"><a href=\"#%E8%89%AF%E3%81%84%E9%83%A8%E5%88%86\" aria-label=\"良い部分 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>良い部分</h3>\n<p><strong>サクッと導入して合わなかったらサクッと廃止できます。</strong><br>\n同じようなものでWindowsの<a href=\"https://forest.watch.impress.co.jp/library/software/changekey/\">Change Key</a>やMacの<a href=\"https://karabiner-elements.pqrs.org/\">Karabiner Elements</a>がありますが、AutoHotkeyはアプリレイヤーで制御するので、アプリを終了すれば通常操作に戻れて、レジストリをいじったりしなくて良いという手軽さが魅力です。</p>\n<h3 id=\"イマイチな部分\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%9E%E3%82%A4%E3%83%81%E3%81%AA%E9%83%A8%E5%88%86\" aria-label=\"イマイチな部分 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>イマイチな部分</h3>\n<p><strong>独自言語で設定します。</strong><br>\n言語仕様はAutoHotkey公式リファレンスを見て学習が必要です。\n少し独特な言語で処理をどこでreturnするか分かりづらい気がします。</p>\n<p><strong>リモート接続PCでは効きません。</strong><br>\nリモート接続先のPCの操作に対してはAutHotkeyの設定は有効になりません。テレワークでリモートPC操作がメインの方だとイマイチかもしれません。これはChange KeyもKarabiner Elementsも同じですが...</p>\n<h2 id=\"実例紹介全体像\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E4%BE%8B%E7%B4%B9%E4%BB%8B%E5%85%A8%E4%BD%93%E5%83%8F\" aria-label=\"実例紹介全体像 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実例紹介：全体像</h2>\n<p>Windowsだと<code class=\"language-text\">Ctrl</code>+スクロールは拡大/縮小、<code class=\"language-text\">Shift</code>+スクロールは横スクロールになっています。\nこのノリを<code class=\"language-text\">Win</code>,<code class=\"language-text\">Alt</code>,<code class=\"language-text\">Tab</code>にも拡張する感じでAutoHotkeyで設定します。<br>\n右手でマウススクロールしながら、左手で<code class=\"language-text\">Win</code>,<code class=\"language-text\">Alt</code>,<code class=\"language-text\">Tab</code>を押下することで、目的のデスクトップ・アプリ・タブに素早く直感的に移動できます。</p>\n<p><img src=\"./overview.png\" alt=\"overview\"></p>\n<h2 id=\"実例紹介ソースコード\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E4%BE%8B%E7%B4%B9%E4%BB%8B%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\" aria-label=\"実例紹介ソースコード permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実例紹介：ソースコード</h2>\n<p>まずはソースコード全量を示します。</p>\n<div class=\"gatsby-code-title\">AutoHotkey設定ファイルの実例</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token punctuation\">;</span> 仮想デスクトップ間移動\n~LWin <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token comment\">#{Left}</span>\n~LWin <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token comment\">#{Right}</span>\n\n<span class=\"token punctuation\">;</span> アプリ間移動\n~LAlt <span class=\"token operator\">&amp;</span> WheelDown::AltTab \n~LAlt <span class=\"token operator\">&amp;</span> WheelUp::ShiftAltTab\n\n<span class=\"token punctuation\">;</span> Tabの修飾キー化\n<span class=\"token variable\">$Tab</span>::\n  startTime :<span class=\"token operator\">=</span> A_TickCount\n  KeyWait, Tab\n  keyPressDuration :<span class=\"token operator\">=</span> A_TickCount - startTime\n  If <span class=\"token punctuation\">(</span>A_ThisHotkey <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$Tab</span>\"</span> and keyPressDuration <span class=\"token operator\">&lt;</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Send, <span class=\"token punctuation\">{</span>Blind<span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span>Tab<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\nReturn\n\n<span class=\"token punctuation\">;</span> タブ間移動：VSCode\n<span class=\"token comment\">#IfWinActive ahk_exe Code.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token punctuation\">{</span>PgUp<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>PgDn<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span>\n\n<span class=\"token punctuation\">;</span> タブ間移動：Chrome\n<span class=\"token comment\">#IfWinActive ahk_exe chrome.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^+<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>以下で処理の塊ごとに説明します。</p>\n<h3 id=\"仮想デスクトップ間移動\" style=\"position:relative;\"><a href=\"#%E4%BB%AE%E6%83%B3%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E9%96%93%E7%A7%BB%E5%8B%95\" aria-label=\"仮想デスクトップ間移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>仮想デスクトップ間移動</h3>\n<p><code class=\"language-text\">Win</code> + スクロール実行時に、<code class=\"language-text\">Win</code> + 左右矢印を発動するように設定します。\n<code class=\"language-text\">Left</code>,<code class=\"language-text\">Right</code>の向きは好みによって変えてください。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">~LWin <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token comment\">#{Left}</span>\n~LWin <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token comment\">#{Right}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"アプリ間移動\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E9%96%93%E7%A7%BB%E5%8B%95\" aria-label=\"アプリ間移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アプリ間移動</h3>\n<p>同じように<code class=\"language-text\">Alt</code>+ スクロール実行時に、<code class=\"language-text\">Alt</code>+<code class=\"language-text\">Tab</code>を発動するように設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">~LAlt <span class=\"token operator\">&amp;</span> WheelDown::AltTab \n~LAlt <span class=\"token operator\">&amp;</span> WheelUp::ShiftAltTab</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<br/>\n<p>※ちなみに<code class=\"language-text\">Alt</code>+<code class=\"language-text\">Tab</code>のアプローチは複数選択肢がありますが、<code class=\"language-text\">Alt</code>を押し続ける必要があり、１つのキーで代替するのは難しく皆さん実現に苦労されているようです。</p>\n<h3 id=\"タブ移動\" style=\"position:relative;\"><a href=\"#%E3%82%BF%E3%83%96%E7%A7%BB%E5%8B%95\" aria-label=\"タブ移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>タブ移動</h3>\n<p>Tabは修飾キー化が必要です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token variable\">$Tab</span>::\n  startTime :<span class=\"token operator\">=</span> A_TickCount\n  <span class=\"token punctuation\">;</span> 押し続けている限りリピートせず待機\n  KeyWait, Tab\n  keyPressDuration :<span class=\"token operator\">=</span> A_TickCount - startTime\n  <span class=\"token punctuation\">;</span> 押下中に他のホットキーが発動した場合は入力無し い\n  <span class=\"token punctuation\">;</span> 長押しの場合も入力無し\n  If <span class=\"token punctuation\">(</span>A_ThisHotkey <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$Tab</span>\"</span> and keyPressDuration <span class=\"token operator\">&lt;</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Send, <span class=\"token punctuation\">{</span>Blind<span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span>Tab<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\nReturn</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>さらにアプリ毎にショートカットキーが異なるのでアプリ別に設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token punctuation\">;</span>マウスホイールでタブ移動（VScode）\n<span class=\"token comment\">#IfWinActive ahk_exe Code.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token punctuation\">{</span>PgUp<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>PgDn<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span>\n\n<span class=\"token punctuation\">;</span>マウスホイールでタブ移動（クローム）\n<span class=\"token comment\">#IfWinActive ahk_exe chrome.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^+<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回紹介したのはスクロールとの組み合わせでしたが、AutoHotkeyは他にもさまざまな設定ができるので便利です。是非使ってみてください🍅</p>","excerpt":"なにこれ Windowsでキーバインドをお気軽にいじれるAutoHotkeyの紹介です。３ヶ月使ってみて色々な設定を試した結果、その中でも特に便利だと感じたマウススクロールと修飾キーの組合せについてご紹介します。 AutoHotkeyとは Windows…","frontmatter":{"slug":"/mahjong-solitaire","title":"上海 (Mahjong Solitaire)","date":"2023-04-07T09:00:00.000+09:00","tags":["キーボード","AutoHotkey","作業効率化"],"keywords":["キーボード"],"thumbnail":"thumbnail/shanghai.png","category":"game"}},{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>Windowsでキーバインドをお気軽にいじれる<a href=\"https://www.autohotkey.com/\">AutoHotkey</a>の紹介です。３ヶ月使ってみて色々な設定を試した結果、その中でも特に便利だと感じたマウススクロールと修飾キーの組合せについてご紹介します。</p>\n<h2 id=\"autohotkeyとは\" style=\"position:relative;\"><a href=\"#autohotkey%E3%81%A8%E3%81%AF\" aria-label=\"autohotkeyとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AutoHotkeyとは</h2>\n<p>Windows版で提供されているソフトウェアで、専用のプログラミング言語でキーバインドを定義すれば、任意のキー入力に対してスクリプトを実行できます。既存のキーに別のキーの割当てたり、複雑なショートカットコマンドの割当が可能です。</p>\n<h3 id=\"良い部分\" style=\"position:relative;\"><a href=\"#%E8%89%AF%E3%81%84%E9%83%A8%E5%88%86\" aria-label=\"良い部分 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>良い部分</h3>\n<p><strong>サクッと導入して合わなかったらサクッと廃止できます。</strong><br>\n同じようなものでWindowsの<a href=\"https://forest.watch.impress.co.jp/library/software/changekey/\">Change Key</a>やMacの<a href=\"https://karabiner-elements.pqrs.org/\">Karabiner Elements</a>がありますが、AutoHotkeyはアプリレイヤーで制御するので、アプリを終了すれば通常操作に戻れて、レジストリをいじったりしなくて良いという手軽さが魅力です。</p>\n<h3 id=\"イマイチな部分\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%9E%E3%82%A4%E3%83%81%E3%81%AA%E9%83%A8%E5%88%86\" aria-label=\"イマイチな部分 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>イマイチな部分</h3>\n<p><strong>独自言語で設定します。</strong><br>\n言語仕様はAutoHotkey公式リファレンスを見て学習が必要です。\n少し独特な言語で処理をどこでreturnするか分かりづらい気がします。</p>\n<p><strong>リモート接続PCでは効きません。</strong><br>\nリモート接続先のPCの操作に対してはAutHotkeyの設定は有効になりません。テレワークでリモートPC操作がメインの方だとイマイチかもしれません。これはChange KeyもKarabiner Elementsも同じですが...</p>\n<h2 id=\"実例紹介全体像\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E4%BE%8B%E7%B4%B9%E4%BB%8B%E5%85%A8%E4%BD%93%E5%83%8F\" aria-label=\"実例紹介全体像 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実例紹介：全体像</h2>\n<p>Windowsだと<code class=\"language-text\">Ctrl</code>+スクロールは拡大/縮小、<code class=\"language-text\">Shift</code>+スクロールは横スクロールになっています。\nこのノリを<code class=\"language-text\">Win</code>,<code class=\"language-text\">Alt</code>,<code class=\"language-text\">Tab</code>にも拡張する感じでAutoHotkeyで設定します。<br>\n右手でマウススクロールしながら、左手で<code class=\"language-text\">Win</code>,<code class=\"language-text\">Alt</code>,<code class=\"language-text\">Tab</code>を押下することで、目的のデスクトップ・アプリ・タブに素早く直感的に移動できます。</p>\n<p><img src=\"./overview.png\" alt=\"overview\"></p>\n<h2 id=\"実例紹介ソースコード\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E4%BE%8B%E7%B4%B9%E4%BB%8B%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\" aria-label=\"実例紹介ソースコード permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実例紹介：ソースコード</h2>\n<p>まずはソースコード全量を示します。</p>\n<div class=\"gatsby-code-title\">AutoHotkey設定ファイルの実例</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token punctuation\">;</span> 仮想デスクトップ間移動\n~LWin <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token comment\">#{Left}</span>\n~LWin <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token comment\">#{Right}</span>\n\n<span class=\"token punctuation\">;</span> アプリ間移動\n~LAlt <span class=\"token operator\">&amp;</span> WheelDown::AltTab \n~LAlt <span class=\"token operator\">&amp;</span> WheelUp::ShiftAltTab\n\n<span class=\"token punctuation\">;</span> Tabの修飾キー化\n<span class=\"token variable\">$Tab</span>::\n  startTime :<span class=\"token operator\">=</span> A_TickCount\n  KeyWait, Tab\n  keyPressDuration :<span class=\"token operator\">=</span> A_TickCount - startTime\n  If <span class=\"token punctuation\">(</span>A_ThisHotkey <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$Tab</span>\"</span> and keyPressDuration <span class=\"token operator\">&lt;</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Send, <span class=\"token punctuation\">{</span>Blind<span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span>Tab<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\nReturn\n\n<span class=\"token punctuation\">;</span> タブ間移動：VSCode\n<span class=\"token comment\">#IfWinActive ahk_exe Code.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token punctuation\">{</span>PgUp<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>PgDn<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span>\n\n<span class=\"token punctuation\">;</span> タブ間移動：Chrome\n<span class=\"token comment\">#IfWinActive ahk_exe chrome.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^+<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>以下で処理の塊ごとに説明します。</p>\n<h3 id=\"仮想デスクトップ間移動\" style=\"position:relative;\"><a href=\"#%E4%BB%AE%E6%83%B3%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E9%96%93%E7%A7%BB%E5%8B%95\" aria-label=\"仮想デスクトップ間移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>仮想デスクトップ間移動</h3>\n<p><code class=\"language-text\">Win</code> + スクロール実行時に、<code class=\"language-text\">Win</code> + 左右矢印を発動するように設定します。\n<code class=\"language-text\">Left</code>,<code class=\"language-text\">Right</code>の向きは好みによって変えてください。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">~LWin <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token comment\">#{Left}</span>\n~LWin <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token comment\">#{Right}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"アプリ間移動\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E9%96%93%E7%A7%BB%E5%8B%95\" aria-label=\"アプリ間移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アプリ間移動</h3>\n<p>同じように<code class=\"language-text\">Alt</code>+ スクロール実行時に、<code class=\"language-text\">Alt</code>+<code class=\"language-text\">Tab</code>を発動するように設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">~LAlt <span class=\"token operator\">&amp;</span> WheelDown::AltTab \n~LAlt <span class=\"token operator\">&amp;</span> WheelUp::ShiftAltTab</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<br/>\n<p>※ちなみに<code class=\"language-text\">Alt</code>+<code class=\"language-text\">Tab</code>のアプローチは複数選択肢がありますが、<code class=\"language-text\">Alt</code>を押し続ける必要があり、１つのキーで代替するのは難しく皆さん実現に苦労されているようです。</p>\n<h3 id=\"タブ移動\" style=\"position:relative;\"><a href=\"#%E3%82%BF%E3%83%96%E7%A7%BB%E5%8B%95\" aria-label=\"タブ移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>タブ移動</h3>\n<p>Tabは修飾キー化が必要です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token variable\">$Tab</span>::\n  startTime :<span class=\"token operator\">=</span> A_TickCount\n  <span class=\"token punctuation\">;</span> 押し続けている限りリピートせず待機\n  KeyWait, Tab\n  keyPressDuration :<span class=\"token operator\">=</span> A_TickCount - startTime\n  <span class=\"token punctuation\">;</span> 押下中に他のホットキーが発動した場合は入力無し い\n  <span class=\"token punctuation\">;</span> 長押しの場合も入力無し\n  If <span class=\"token punctuation\">(</span>A_ThisHotkey <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$Tab</span>\"</span> and keyPressDuration <span class=\"token operator\">&lt;</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Send, <span class=\"token punctuation\">{</span>Blind<span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span>Tab<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\nReturn</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>さらにアプリ毎にショートカットキーが異なるのでアプリ別に設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token punctuation\">;</span>マウスホイールでタブ移動（VScode）\n<span class=\"token comment\">#IfWinActive ahk_exe Code.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token punctuation\">{</span>PgUp<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>PgDn<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span>\n\n<span class=\"token punctuation\">;</span>マウスホイールでタブ移動（クローム）\n<span class=\"token comment\">#IfWinActive ahk_exe chrome.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^+<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回紹介したのはスクロールとの組み合わせでしたが、AutoHotkeyは他にもさまざまな設定ができるので便利です。是非使ってみてください🍅</p>","excerpt":"なにこれ Windowsでキーバインドをお気軽にいじれるAutoHotkeyの紹介です。３ヶ月使ってみて色々な設定を試した結果、その中でも特に便利だと感じたマウススクロールと修飾キーの組合せについてご紹介します。 AutoHotkeyとは Windows…","frontmatter":{"slug":"/rpg-maker","title":"自作RPGゲームエンジン","date":"2023-04-07T09:00:00.000+09:00","tags":["RPG"],"keywords":["RPG"],"thumbnail":"thumbnail/default.png","category":"game"}},{"html":"<p>プログラミングの参考や勉強になるWebサイトを集めた。</p>\n<h2 id=\"github\" style=\"position:relative;\"><a href=\"#github\" aria-label=\"github permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>github</h2>","excerpt":"プログラミングの参考や勉強になるWebサイトを集めた。 github","frontmatter":{"slug":"/bookmarks","title":"リンク集","date":"2023-04-07T09:00:00.000+09:00","tags":["リンク集"],"keywords":["links"],"thumbnail":"thumbnail/2023/04/autohotkey-mouse-scroll-combination.png","category":"note"}},{"html":"<h2 id=\"メルセンヌツイスタmersenne-twister-mt法\" style=\"position:relative;\"><a href=\"#%E3%83%A1%E3%83%AB%E3%82%BB%E3%83%B3%E3%83%8C%E3%83%84%E3%82%A4%E3%82%B9%E3%82%BFmersenne-twister-mt%E6%B3%95\" aria-label=\"メルセンヌツイスタmersenne twister mt法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>メルセンヌ・ツイスタ（Mersenne Twister, MT）法</h2>\n<p>松本眞・西村拓士両氏によって1996年に発表された擬似乱数生成アルゴリズムである。 他の擬似乱数生成アルゴリズムと比べて以下の特徴がある。 （「Mersenne Twister とは?」より）</p>\n<ul>\n<li>\n<p>従来の様々な生成法の欠点を考慮して設計されています。</p>\n</li>\n<li>\n<p>従来にない長周期, 高次元均等分布を持ちます。（周期が<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>19937</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{19937} -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">19937</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span>で<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>、623次元超立方体の中に 均等に分布することが証明されています。）</p>\n</li>\n<li>\n<p>生成速度がかなり速い。（処理系にもよりますが、パイプライン処理やキャッシュメモリ のあるシステムでは、Cの標準ライブラリの rand() より高速なこと もあります。なお、開発当時には cokus 版は rand() より4倍程度高速でしたが、その後 ANSI-C の rand() が LCG 法から lagged-fibonacci に 変更されたこともあり、2002年現在 rand と MT の速度差はあまりありません。）</p>\n</li>\n<li>\n<p>メモリ効率が良い。（32ビット以上のマシン用に設計された mt19937.c は、 624ワードのワーキングメモリを消費するだけです。 1ワードは32ビット長とします。</p>\n</li>\n</ul>\n<p>MT法を利用したJavascsriptライブラリを開発した。</p>\n<hr>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\"><span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>19937</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{19937} -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">19937</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span>はメルセンヌ素数で Mersenne Twister の名前の由来になっている。 Mersenne Twister では周期サイズごとに複数の実装があるが,<span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>19937</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{19937} -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">19937</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span>がポピュラーな実装として広く使われている。<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","excerpt":"メルセンヌ・ツイスタ（Mersenne Twister, MT）法 松本眞・西村拓士両氏によって1996年に発表された擬似乱数生成アルゴリズムである。 他の擬似乱数生成アルゴリズムと比べて以下の特徴がある。 （「Mersenne Twister…","frontmatter":{"slug":"/mersenne-twister","title":"メルセンヌ・ツイスター法による乱数生成Javascriptライブラリ","date":"2023-04-07T09:00:00.000+09:00","tags":["typescript"],"keywords":["乱数"],"thumbnail":"thumbnail/540px-Npm-logo.png","category":"software"}},{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>Windowsでキーバインドをお気軽にいじれる<a href=\"https://www.autohotkey.com/\">AutoHotkey</a>の紹介です。３ヶ月使ってみて色々な設定を試した結果、その中でも特に便利だと感じたマウススクロールと修飾キーの組合せについてご紹介します。</p>\n<h2 id=\"autohotkeyとは\" style=\"position:relative;\"><a href=\"#autohotkey%E3%81%A8%E3%81%AF\" aria-label=\"autohotkeyとは permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AutoHotkeyとは</h2>\n<p>Windows版で提供されているソフトウェアで、専用のプログラミング言語でキーバインドを定義すれば、任意のキー入力に対してスクリプトを実行できます。既存のキーに別のキーの割当てたり、複雑なショートカットコマンドの割当が可能です。</p>\n<h3 id=\"良い部分\" style=\"position:relative;\"><a href=\"#%E8%89%AF%E3%81%84%E9%83%A8%E5%88%86\" aria-label=\"良い部分 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>良い部分</h3>\n<p><strong>サクッと導入して合わなかったらサクッと廃止できます。</strong><br>\n同じようなものでWindowsの<a href=\"https://forest.watch.impress.co.jp/library/software/changekey/\">Change Key</a>やMacの<a href=\"https://karabiner-elements.pqrs.org/\">Karabiner Elements</a>がありますが、AutoHotkeyはアプリレイヤーで制御するので、アプリを終了すれば通常操作に戻れて、レジストリをいじったりしなくて良いという手軽さが魅力です。</p>\n<h3 id=\"イマイチな部分\" style=\"position:relative;\"><a href=\"#%E3%82%A4%E3%83%9E%E3%82%A4%E3%83%81%E3%81%AA%E9%83%A8%E5%88%86\" aria-label=\"イマイチな部分 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>イマイチな部分</h3>\n<p><strong>独自言語で設定します。</strong><br>\n言語仕様はAutoHotkey公式リファレンスを見て学習が必要です。\n少し独特な言語で処理をどこでreturnするか分かりづらい気がします。</p>\n<p><strong>リモート接続PCでは効きません。</strong><br>\nリモート接続先のPCの操作に対してはAutHotkeyの設定は有効になりません。テレワークでリモートPC操作がメインの方だとイマイチかもしれません。これはChange KeyもKarabiner Elementsも同じですが...</p>\n<h2 id=\"実例紹介全体像\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E4%BE%8B%E7%B4%B9%E4%BB%8B%E5%85%A8%E4%BD%93%E5%83%8F\" aria-label=\"実例紹介全体像 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実例紹介：全体像</h2>\n<p>Windowsだと<code class=\"language-text\">Ctrl</code>+スクロールは拡大/縮小、<code class=\"language-text\">Shift</code>+スクロールは横スクロールになっています。\nこのノリを<code class=\"language-text\">Win</code>,<code class=\"language-text\">Alt</code>,<code class=\"language-text\">Tab</code>にも拡張する感じでAutoHotkeyで設定します。<br>\n右手でマウススクロールしながら、左手で<code class=\"language-text\">Win</code>,<code class=\"language-text\">Alt</code>,<code class=\"language-text\">Tab</code>を押下することで、目的のデスクトップ・アプリ・タブに素早く直感的に移動できます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d082bf6a56df1485c5e3ec8941754e8/d6bb7/overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcRAAAXEQHKJvM/AAACR0lEQVR42pWSz2/ScBTA+Yc9ePBu9KQHs+jBaGKyuJglM24DhigUxu8fbQessjEzaGHl2wJtKdANFhP3MZRdjLt4+OS9l7z3ycvLiwTBgmCx4HodgwWLxaYOgv8lWM+uIq2OyXnPwjAnDITDbuKE2Lcio/EEzw9wvBnudIY3neGG+fwf1j3+bB5KI7F8jz2py/5xj8O8znb8B58SbaJ5nVjBIFq84rBgsp+3iJeGRAuDv4gVB+xJBhf6hOVNcBfJNQTJmiAlCwrNIfmmzcSbU9YE5VPB95JGulhHzrxi9yCJJBtkFYOMbIS5JOukajoVTTCbL4ikFItoxeaoNkJSBfGKxdj1yaoWkmJTL3yglXtOW3pEKfkUNf+aRmGLRnELrfyGC/k9p8UX1OUM3mxFJK1YxCo2iZodChNVi5HjI6k25abOrVvll1fDtRoI8wfHShfPrDAxK2jNHd5+fII4i+OOzph4wcNC0/JIKzaVls7vhQo3DQJHxRbnZNUrll6LTu+IWPUZ7+KPkeovOdezTP3lw8Lx/YahcKZAoBJMFCxTQ6r/ZOU0aHWSFNo7aN1DSto2jU4O/yHh13thRrWptnTu5gpcb4T2sE1WNVi5KuplikzvC5nLAzLdz9Qvi/j+DZGUbBEt2xxVbdKKIFbe3DCl2BSbOktX5XZ6gitU+v0z0nIfzzqhZ1QZiBzGsMBAZOn2m3hr4XDk0xc+A8vHtKfow2n4pFfWNLylPXZCrJHD0HbpCw8xchiNPTzHw10zce/czXMHfwBVkQajLKbkaAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4d082bf6a56df1485c5e3ec8941754e8/ba381/overview.webp 200w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/7f61c/overview.webp 400w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/d00b9/overview.webp 800w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/92f8c/overview.webp 1200w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/fad48/overview.webp 1600w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/4f632/overview.webp 2157w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4d082bf6a56df1485c5e3ec8941754e8/772e8/overview.png 200w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/e17e5/overview.png 400w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/5a190/overview.png 800w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/c1b63/overview.png 1200w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/29007/overview.png 1600w,\n/static/4d082bf6a56df1485c5e3ec8941754e8/d6bb7/overview.png 2157w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4d082bf6a56df1485c5e3ec8941754e8/5a190/overview.png\"\n            alt=\"overview\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"実例紹介ソースコード\" style=\"position:relative;\"><a href=\"#%E5%AE%9F%E4%BE%8B%E7%B4%B9%E4%BB%8B%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\" aria-label=\"実例紹介ソースコード permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実例紹介：ソースコード</h2>\n<p>まずはソースコード全量を示します。</p>\n<div class=\"gatsby-code-title\">AutoHotkey設定ファイルの実例</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token punctuation\">;</span> 仮想デスクトップ間移動\n~LWin <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token comment\">#{Left}</span>\n~LWin <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token comment\">#{Right}</span>\n\n<span class=\"token punctuation\">;</span> アプリ間移動\n~LAlt <span class=\"token operator\">&amp;</span> WheelDown::AltTab \n~LAlt <span class=\"token operator\">&amp;</span> WheelUp::ShiftAltTab\n\n<span class=\"token punctuation\">;</span> Tabの修飾キー化\n<span class=\"token variable\">$Tab</span>::\n  startTime :<span class=\"token operator\">=</span> A_TickCount\n  KeyWait, Tab\n  keyPressDuration :<span class=\"token operator\">=</span> A_TickCount - startTime\n  If <span class=\"token punctuation\">(</span>A_ThisHotkey <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$Tab</span>\"</span> and keyPressDuration <span class=\"token operator\">&lt;</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Send, <span class=\"token punctuation\">{</span>Blind<span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span>Tab<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\nReturn\n\n<span class=\"token punctuation\">;</span> タブ間移動：VSCode\n<span class=\"token comment\">#IfWinActive ahk_exe Code.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token punctuation\">{</span>PgUp<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>PgDn<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span>\n\n<span class=\"token punctuation\">;</span> タブ間移動：Chrome\n<span class=\"token comment\">#IfWinActive ahk_exe chrome.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^+<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>以下で処理の塊ごとに説明します。</p>\n<h3 id=\"仮想デスクトップ間移動\" style=\"position:relative;\"><a href=\"#%E4%BB%AE%E6%83%B3%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E9%96%93%E7%A7%BB%E5%8B%95\" aria-label=\"仮想デスクトップ間移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>仮想デスクトップ間移動</h3>\n<p><code class=\"language-text\">Win</code> + スクロール実行時に、<code class=\"language-text\">Win</code> + 左右矢印を発動するように設定します。\n<code class=\"language-text\">Left</code>,<code class=\"language-text\">Right</code>の向きは好みによって変えてください。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">~LWin <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token comment\">#{Left}</span>\n~LWin <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token comment\">#{Right}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3 id=\"アプリ間移動\" style=\"position:relative;\"><a href=\"#%E3%82%A2%E3%83%97%E3%83%AA%E9%96%93%E7%A7%BB%E5%8B%95\" aria-label=\"アプリ間移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>アプリ間移動</h3>\n<p>同じように<code class=\"language-text\">Alt</code>+ スクロール実行時に、<code class=\"language-text\">Alt</code>+<code class=\"language-text\">Tab</code>を発動するように設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">~LAlt <span class=\"token operator\">&amp;</span> WheelDown::AltTab \n~LAlt <span class=\"token operator\">&amp;</span> WheelUp::ShiftAltTab</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<br/>\n<p>※ちなみに<code class=\"language-text\">Alt</code>+<code class=\"language-text\">Tab</code>のアプローチは複数選択肢がありますが、<code class=\"language-text\">Alt</code>を押し続ける必要があり、１つのキーで代替するのは難しく皆さん実現に苦労されているようです。</p>\n<h3 id=\"タブ移動\" style=\"position:relative;\"><a href=\"#%E3%82%BF%E3%83%96%E7%A7%BB%E5%8B%95\" aria-label=\"タブ移動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>タブ移動</h3>\n<p>Tabは修飾キー化が必要です。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token variable\">$Tab</span>::\n  startTime :<span class=\"token operator\">=</span> A_TickCount\n  <span class=\"token punctuation\">;</span> 押し続けている限りリピートせず待機\n  KeyWait, Tab\n  keyPressDuration :<span class=\"token operator\">=</span> A_TickCount - startTime\n  <span class=\"token punctuation\">;</span> 押下中に他のホットキーが発動した場合は入力無し い\n  <span class=\"token punctuation\">;</span> 長押しの場合も入力無し\n  If <span class=\"token punctuation\">(</span>A_ThisHotkey <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$Tab</span>\"</span> and keyPressDuration <span class=\"token operator\">&lt;</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Send, <span class=\"token punctuation\">{</span>Blind<span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span>Tab<span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\nReturn</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>さらにアプリ毎にショートカットキーが異なるのでアプリ別に設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token punctuation\">;</span>マウスホイールでタブ移動（VScode）\n<span class=\"token comment\">#IfWinActive ahk_exe Code.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^<span class=\"token punctuation\">{</span>PgUp<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>PgDn<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span>\n\n<span class=\"token punctuation\">;</span>マウスホイールでタブ移動（クローム）\n<span class=\"token comment\">#IfWinActive ahk_exe chrome.exe</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelUp::send,^+<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\n  ~Tab <span class=\"token operator\">&amp;</span> WheelDown::send,^<span class=\"token punctuation\">{</span>tab<span class=\"token punctuation\">}</span>\nReturn\n<span class=\"token comment\">#IfWinActiveW</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回紹介したのはスクロールとの組み合わせでしたが、AutoHotkeyは他にもさまざまな設定ができるので便利です。是非使ってみてください🍅</p>","excerpt":"なにこれ Windowsでキーバインドをお気軽にいじれるAutoHotkeyの紹介です。３ヶ月使ってみて色々な設定を試した結果、その中でも特に便利だと感じたマウススクロールと修飾キーの組合せについてご紹介します。 AutoHotkeyとは Windows…","frontmatter":{"slug":"/autohotkey-mouse-scroll-combination","title":"AutoHotkey スクロールと修飾キーの組合せが便利","date":"2023-04-07T09:00:00.000+09:00","tags":["キーボード","AutoHotkey","作業効率化"],"keywords":["キーボード"],"thumbnail":"thumbnail/2023/04/autohotkey-mouse-scroll-combination.png","category":null}}],"previous":{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>VuetifyのDataTableとPaginationを使った検索一覧画面でページングの状態を、ルーティングをまたいで保存しておきたい。という要望を満たすため、ページングの状態をVuexで管理する方法をメモします。\nDataTableだけだとすんなりできますが、Paginationもあわせて使う場合は少し雑な実装になってしまいます。</p>\n<h2 id=\"やり方\" style=\"position:relative;\"><a href=\"#%E3%82%84%E3%82%8A%E6%96%B9\" aria-label=\"やり方 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>やり方</h2>\n<p>まずはストアに以下のように定義します。\nアクションには「ページングオブジェクト保存」と「ページングオブジェクトのページのみ保存」の2種類を用意します。</p>\n<div class=\"gatsby-code-title\">サンプル実装（Vuex側）</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vuex<span class=\"token punctuation\">.</span>Store</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">state</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">pagination</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">page</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">rowsPerPage</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">sortBy</span><span class=\"token operator\">:</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">descending</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token literal-property property\">getter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">getPagination</span><span class=\"token operator\">:</span> <span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>pagination<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token literal-property property\">actions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">SAVE_PAGINATION</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> commit <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> payload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n        page<span class=\"token punctuation\">,</span>\n        rowsPerPage<span class=\"token punctuation\">,</span>\n        sortBy<span class=\"token punctuation\">,</span>\n        descending<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> payload<span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'savePagination'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        page<span class=\"token punctuation\">,</span>\n        rowsPerPage<span class=\"token punctuation\">,</span>\n        sortBy<span class=\"token punctuation\">,</span>\n        descending<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token constant\">SAVE_PAGINATION_PAGE</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> commit <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> payload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> payload<span class=\"token punctuation\">;</span>\n      <span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'savePaginationPage'</span><span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token literal-property property\">mutations</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">savePagination</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> pagination</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      state<span class=\"token punctuation\">.</span>pagination <span class=\"token operator\">=</span> pagination<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">savePaginationPage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> page</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      state<span class=\"token punctuation\">.</span>pagination<span class=\"token punctuation\">.</span>page <span class=\"token operator\">=</span> page<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>次にコンポーネント側です。\n<code class=\"language-text\">v-data-table</code>,<code class=\"language-text\">v-pagination</code>ともにVuexのページングオブジェクトを参照し、UIで変更があればVuexのアクションを呼び出します。それぞれのタグで微妙にやり方が違います。\nもう少しスマートにしたかったのですが、実際動かしてみた感じだとどうしてもスマートにはできませんでした。</p>\n<div class=\"gatsby-code-title\">サンプル実装（コンポーネント側）</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>\n      ページングはpaginationに任せるのでhide<span class=\"token operator\">-</span>actionsを指定している\n      pagination<span class=\"token punctuation\">.</span>syncにはgetterとsetterを持たせたpaginationを指定\n    <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>v<span class=\"token operator\">-</span>data<span class=\"token operator\">-</span>table\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token operator\">:</span>pagination<span class=\"token punctuation\">.</span>sync<span class=\"token operator\">=</span><span class=\"token string\">\"pagination\"</span></span>      <span class=\"token operator\">:</span>items<span class=\"token operator\">=</span><span class=\"token string\">\"items\"</span>\n      hide<span class=\"token operator\">-</span>actions\n    <span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> テーブルの中身 <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>v<span class=\"token operator\">-</span>data<span class=\"token operator\">-</span>table<span class=\"token operator\">></span>\n\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>\n      valueでVuexのページングオブジェクトを参照して\n      <span class=\"token constant\">UI</span>側からの変更は@inputでVuexのアクションを呼び出す\n    <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>v<span class=\"token operator\">-</span>pagination\n      <span class=\"token operator\">:</span>length<span class=\"token operator\">=</span><span class=\"token string\">\"pages\"</span>\n      v<span class=\"token operator\">-</span><span class=\"token keyword\">if</span><span class=\"token operator\">=</span><span class=\"token string\">\"pages >= 2\"</span>\n      <span class=\"token operator\">:</span>total<span class=\"token operator\">-</span>visible<span class=\"token operator\">=</span><span class=\"token string\">\"7\"</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token operator\">:</span>value<span class=\"token operator\">=</span><span class=\"token string\">\"paginationPage\"</span></span><span class=\"gatsby-highlight-code-line\">      @input<span class=\"token operator\">=</span><span class=\"token string\">\"savePaginationPageInStore({ page: $event })\"</span></span>    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> mapActions<span class=\"token punctuation\">,</span> mapGetters <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vuex'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n\n\n  <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n\n  <span class=\"token literal-property property\">computed</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token function\">mapGetters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">paginationInStore</span><span class=\"token operator\">:</span> <span class=\"token string\">'getPagination'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token literal-property property\">pagination</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// Vuexのページングオブジェクトを参照</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>paginationInStore<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// UI側から変更があった場合はSetter経由でVuexのアクションを呼び出す</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>pagination<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">savePaginationInStore</span><span class=\"token punctuation\">(</span>pagination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span>\n    <span class=\"token comment\">// ページネーション参照用</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">paginationPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>paginationInStore<span class=\"token punctuation\">.</span>page<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\"></span>    <span class=\"token comment\">// ページネーション用ページ数算出メソッド</span>\n    <span class=\"token function\">pages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pagination<span class=\"token punctuation\">.</span>rowsPerPage <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span>length <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pagination<span class=\"token punctuation\">.</span>rowsPerPage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n\n  <span class=\"token literal-property property\">methods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token function\">mapActions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">savePaginationInStore</span><span class=\"token operator\">:</span> <span class=\"token string\">'SAVE_PAGINATION'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">savePaginationPageInStore</span><span class=\"token operator\">:</span> <span class=\"token string\">'SAVE_PAGINATION_PAGE'</span><span class=\"token punctuation\">,</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>これでルーティングをまたいでページングオブジェクトを保持できるようになりました。\n実用の場面では、検索条件もVuexに持たせて、ページングオブジェクトと連動させて使います。<br/>\n以上です🍅</p>","excerpt":"なにこれ VuetifyのDataTableとPaginationを使った検索一覧画面でページングの状態を、ルーティングをまたいで保存しておきたい。という要望を満たすため、ページングの状態をVuexで管理する方法をメモします。\nDataTable…","frontmatter":{"slug":"/vuetify-datatable-and-pagination-with-vuex","title":"VuetifyのDataTableとPaginationの状態をVuexで管理する","date":"2019-04-28T20:30:00.000+09:00","tags":["Vue.js","Vuetify","Vuex"],"keywords":["Vue.js"],"thumbnail":"thumbnail/2019/04/vuetify-datatable-and-pagination-with-vuex.png","category":null}},"next":{"html":"<h2 id=\"なにこれ\" style=\"position:relative;\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-label=\"なにこれ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>WordCloudをJSだけで生成したい。Pythonとか使わずにフロントエンドだけでやりたい。というモチベーションで、\n<a href=\"https://github.com/takuyaa/kuromoji.js/\">kuromoji.js</a>と<a href=\"https://github.com/jasondavies/d3-cloud\">D3-Cloud</a>を使って文字列をインプットにWordCloudを描画するReactアプリを作ってみました。今回はそのやり方についてご紹介します。</p>\n<p>※サンプルコードは以下に置いております。\n<a href=\"https://github.com/Takumon/playbox2019/blob/master/react-kuromoji-sample/src/App.js\">https://github.com/Takumon/playbox2019/blob/master/react-kuromoji-sample/src/App.js</a></p>\n<h2 id=\"wordcloudの作り方原理\" style=\"position:relative;\"><a href=\"#wordcloud%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9%E5%8E%9F%E7%90%86\" aria-label=\"wordcloudの作り方原理 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WordCloudの作り方（原理）</h2>\n<p>WordCloudは文章をインプットにして画像をアウトプットします。\nその過程は2つに分かれます。</p>\n<h3 id=\"1-文章を解析して単語出現回数をデータ化\" style=\"position:relative;\"><a href=\"#1-%E6%96%87%E7%AB%A0%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%97%E3%81%A6%E5%8D%98%E8%AA%9E%E5%87%BA%E7%8F%BE%E5%9B%9E%E6%95%B0%E3%82%92%E3%83%87%E3%83%BC%E3%82%BF%E5%8C%96\" aria-label=\"1 文章を解析して単語出現回数をデータ化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 文章を解析して単語出現回数をデータ化</h3>\n<div class=\"gatsby-code-title\">たとえばこんな文章を...</div>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">そこも場合もうその病気らに対して旨の時がしんませ。単に事実に使用方はどうかその応用たないでもが思いてならないがも発展思いうべきて、あいにくにもなるだなですた。\n差が向いんものは何だか翌日からしきりにんなけれう。もちろんネルソンさんで養成道具一応束縛に致しませ示威この力誰か講演をというご妨害ないますですうば、\n...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>↓↓</p>\n<div class=\"gatsby-code-title\">単語と出現回数のデータに加工します</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"そこ\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">14</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"場合\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">11</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"うそ\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"病気\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">8</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ら\"</span><span class=\"token punctuation\">,</span>      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">17</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"旨\"</span><span class=\"token punctuation\">,</span>      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"時\"</span><span class=\"token punctuation\">,</span>      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">43</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"しん\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"事実\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"使用\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"方\"</span><span class=\"token punctuation\">,</span>      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">41</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"応用\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ない\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">175</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"思う\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">39</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"なる\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">99</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"発展\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">13</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"思い\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"くる\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">8</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"差\"</span><span class=\"token punctuation\">,</span>      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">\"向く\"</span><span class=\"token punctuation\">,</span>    <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"2-データをもとにイイ感じの画像出力\" style=\"position:relative;\"><a href=\"#2-%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%82%E3%81%A8%E3%81%AB%E3%82%A4%E3%82%A4%E6%84%9F%E3%81%98%E3%81%AE%E7%94%BB%E5%83%8F%E5%87%BA%E5%8A%9B\" aria-label=\"2 データをもとにイイ感じの画像出力 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. データをもとにイイ感じの画像出力</h3>\n<p>単語と出現回数の他に、以下の値を何らかの形で決定します。</p>\n<ul>\n<li>フォントの大きさ</li>\n<li>フォントの回転位置</li>\n<li>フォントの種類</li>\n<li>フォントの色</li>\n<li>表示位置</li>\n</ul>\n<p>大体のWordCloud系ライブラリは出現回数が多い単語を大きく中心に配置し、\nその周りに敷き詰めるように他の単語を配置します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/76191097103de55829c825fc63f9828a/748b0/wordcloud-sample.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAENElEQVR42kWS624aZwJAedl9kNXuj0p7UdTLrrorbXerNm0um5hkEjtxHGzHEAzmAzw2twGGuQ9zgYEBhst8PlXVH32BI52jU1DV1lcj3epNG29v1lf/FaPRG2G4FRHexWI28sSbW0s8/dQVP37qCuvOEd26JxqfHRENZ8Ib+0KLI9Hzw5uWF/QajcajgmHqypyULNZy4j6rrEW+6ZH5GotsTa07oTxZUjXWZMuQ3OySGWOw75GLDHu+5zjd5G+2MHKcYkGf6K8yEppmtH/d8uV0tpBc/0duP34hN+0nkvI3cq9dyMDey4XWlQf9WnL1SB4u/yYtN5XGXSjb6/W+lO4xbPtlYawbSnIAMZnl35fHdMIMaV3Dsz+QGg6Zcc9D8xlTD9Ig4VD7gYf3f+bQVfA0nZu7iNNZkncOoFtWsaCPB8phmzL3zTx0l0zjDXz8E/LiW1YRyPsy2/4R8zSA1lMeescs5zEbZ8ju7d8piYB/RfP8+WLHyLSKhYFhKqx06Cr5pjlD2iYPNz8ga09YBrBVzzlUvmQXD8CoQflrHkp/Zd8scij/D7Nj0Rkbubt/wHLdYsG2HQVW5EGUr7SE7Sjl4CRgtgmGDk+vNaR2xso3WfgWmVCQv2qrL5m/KpKefsB7+yzHC5jUh8WCaZoK7Jj7Tj4xbQLTpl+tcFep4N0JXjddfrwJSOczVvOIXesW2b5mmy1IL0tsHYefwtPcywK85qRYsF1X4SBZW3a+negsfJ/edZlho0bzwzGLqcl5x+SPRyr/LvV5fNrntl4Dq0rut9mvFljtcs56xcT0igVT0xTSBdHUz23TxxxPGIk6ekvQrVyxXfm8V3X+8rbPu7bJS7X9ayuCB5g7Dqt370gqtXxu6KiiXiwYuq64C4kX+3k4V0nmNlq1QvtTCa9X53l9wk9VCysdUHXO+e72W150n6JGY9SpSmN4zj5K8kOSMLhVi4WxriuTJehOLV8uq0ytK4aNOoPrCvdC8N2lxmIW4I6GHA+Oed75PyeTDzQHFzitGqo7Jj15l3PfQdcnxYJj2wpAuJrl0fIOyyij1auoF2fcHCtMgym98YhZEiPcBo/bj3k9OkEML0lOzhF+Rvzieb6tVKi3mr8D+zM3PzNP6Rq3DD5fcfvxBLVySaLrZNqIj/oZyvANxf4RT+5/5kR/D2qf2dEL0vOLXG42lPq/bfNKAk4a7Rt+Qw5DTTqDoex+FnIWRHL54UzG//in1HqqrHSqsj9syWb3s2z6ujwK13JomjK0f96vWfBp5L0sOE6kQMAu6+W2NSXwbXbpDl/bsl9twbFhFrNZpiyTlF264iGJSTcrqpnE3e85bNQcNqiTXrFw31a/SmKrF3rmjTkciVG3I1xjIjzPFaHjiNgwRZLEYjENhR/FIg5nIg0dETlj4TmuiD1HRNPZjakPeqVG6dEvx/OxlPZOgfsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/76191097103de55829c825fc63f9828a/ba381/wordcloud-sample.webp 200w,\n/static/76191097103de55829c825fc63f9828a/7f61c/wordcloud-sample.webp 400w,\n/static/76191097103de55829c825fc63f9828a/d00b9/wordcloud-sample.webp 800w,\n/static/76191097103de55829c825fc63f9828a/1ae05/wordcloud-sample.webp 868w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/76191097103de55829c825fc63f9828a/772e8/wordcloud-sample.png 200w,\n/static/76191097103de55829c825fc63f9828a/e17e5/wordcloud-sample.png 400w,\n/static/76191097103de55829c825fc63f9828a/5a190/wordcloud-sample.png 800w,\n/static/76191097103de55829c825fc63f9828a/748b0/wordcloud-sample.png 868w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/76191097103de55829c825fc63f9828a/5a190/wordcloud-sample.png\"\n            alt=\"wordcloud sample\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"wordcloudの作り方実装\" style=\"position:relative;\"><a href=\"#wordcloud%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9%E5%AE%9F%E8%A3%85\" aria-label=\"wordcloudの作り方実装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WordCloudの作り方（実装）</h2>\n<p>自前実装の必要はありません。<a href=\"https://github.com/takuyaa/kuromoji.js/\">kuromoji.js</a>と<a href=\"https://github.com/jasondavies/d3-cloud\">D3-Cloud</a>というライブラリを使えば簡単に実装できます。\nさらに<a href=\"https://github.com/Yoctol/react-d3-cloud\">react-d3-cloud</a>というD3-CloudをReactで使うためのライブラリもあったので、それを使ってReactアプリを実装します。</p>\n<h3 id=\"1-文章を解析して単語出現回数をデータ化-1\" style=\"position:relative;\"><a href=\"#1-%E6%96%87%E7%AB%A0%E3%82%92%E8%A7%A3%E6%9E%90%E3%81%97%E3%81%A6%E5%8D%98%E8%AA%9E%E5%87%BA%E7%8F%BE%E5%9B%9E%E6%95%B0%E3%82%92%E3%83%87%E3%83%BC%E3%82%BF%E5%8C%96-1\" aria-label=\"1 文章を解析して単語出現回数をデータ化 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 文章を解析して単語出現回数をデータ化</h3>\n<p>kuromoji.jsは形態素解析で辞書を使います。\nkuromoji.jsをインストールすると辞書がバンドルされています。\nReactで使う場合は以下のように辞書の場所を移動して、辞書をブラウザから読み込めるようにしておく必要があります。</p>\n<div class=\"gatsby-code-title\">辞書をブラウザから読み込める場所にコピー</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cp</span> <span class=\"token parameter variable\">-a</span> node_modules/kuromoji/dict public/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<br/>\n<p>kuromoji.jsの解析結果は以下のようになります。\n色々ありますが、今回は<code class=\"language-text\">pos（品詞）</code>と<code class=\"language-text\">surface_form（表層形）</code>または<code class=\"language-text\">basic_form（基本形）</code>のみを使います。</p>\n<div class=\"gatsby-code-title\">kuromoji.js解析結果の形式</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">word_id</span><span class=\"token operator\">:</span> <span class=\"token number\">509800</span><span class=\"token punctuation\">,</span>          <span class=\"token comment\">// 辞書内での単語ID</span>\n  <span class=\"token literal-property property\">word_type</span><span class=\"token operator\">:</span> <span class=\"token string\">'KNOWN'</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">// 単語タイプ(辞書に登録されている単語ならKNOWN, 未知語ならUNKNOWN)</span>\n  <span class=\"token literal-property property\">word_position</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>         <span class=\"token comment\">// 単語の開始位置</span>\n  <span class=\"token literal-property property\">surface_form</span><span class=\"token operator\">:</span> <span class=\"token string\">'黒文字'</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\">// 表層形</span>\n  <span class=\"token literal-property property\">pos</span><span class=\"token operator\">:</span> <span class=\"token string\">'名詞'</span><span class=\"token punctuation\">,</span>               <span class=\"token comment\">// 品詞</span>\n  <span class=\"token literal-property property\">pos_detail_1</span><span class=\"token operator\">:</span> <span class=\"token string\">'一般'</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 品詞細分類1</span>\n  <span class=\"token literal-property property\">pos_detail_2</span><span class=\"token operator\">:</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\">// 品詞細分類2</span>\n  <span class=\"token literal-property property\">pos_detail_3</span><span class=\"token operator\">:</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\">// 品詞細分類3</span>\n  <span class=\"token literal-property property\">conjugated_type</span><span class=\"token operator\">:</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// 活用型</span>\n  <span class=\"token literal-property property\">conjugated_form</span><span class=\"token operator\">:</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// 活用形</span>\n  <span class=\"token literal-property property\">basic_form</span><span class=\"token operator\">:</span> <span class=\"token string\">'黒文字'</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 基本形</span>\n  <span class=\"token literal-property property\">reading</span><span class=\"token operator\">:</span> <span class=\"token string\">'クロモジ'</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">// 読み</span>\n  <span class=\"token literal-property property\">pronunciation</span><span class=\"token operator\">:</span> <span class=\"token string\">'クロモジ'</span>  <span class=\"token comment\">// 発音</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>Reactコンポーネントでは以下のように実装します。</p>\n<div class=\"gatsby-code-title\">テキスト加工処理</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> kuromoji <span class=\"token keyword\">from</span> <span class=\"token string\">'kuromoji'</span>\n\n<span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">そこも場合もうその病気らに対して旨の時がしんませ。\n単に事実に使用方はどうかその応用たないでもが思いてならないがも発展思いうべきて、\n...\n</span><span class=\"token template-punctuation string\">`</span></span>\n\n<span class=\"token comment\">// 辞書格納フォルダパス</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">DIC_URL</span> <span class=\"token operator\">=</span> <span class=\"token string\">'/dict'</span>\n\n<span class=\"token comment\">// WordCloudの情報として抽出する品詞（助詞、助動詞などは意味がないので拾わない）</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">TARGET_POS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'名詞'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'動詞'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'形容詞'</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">// kuromoji.jsの解析結果の値で特に値がない場合は以下の文字が設定される</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NO_CONTENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'*'</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// kuromoji.jsによる形態素解析は非同期なので</span>\n  <span class=\"token comment\">// 解析結果はstateのプロパティとしてコンストラクタで初期化しておく</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">dataForD3Cloud</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentWillMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 辞書を読み混んでトークナイザー（形態素解析するための関数）を生成</span>\n    kuromoji<span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">dicPath</span><span class=\"token operator\">:</span> <span class=\"token constant\">DIC_URL</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> tokenizer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// テキストを引数にして形態素解析</span>\n      <span class=\"token keyword\">const</span> tokens <span class=\"token operator\">=</span> tokenizer<span class=\"token punctuation\">.</span><span class=\"token function\">tokenize</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// 解析結果から単語と出現回数を抽出</span>\n      <span class=\"token keyword\">const</span> dataForD3Cloud <span class=\"token operator\">=</span> tokens\n        <span class=\"token comment\">// pos（品詞）を参照し、'名詞', '動詞', '形容詞'のみを抽出</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token constant\">TARGET_POS</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 単語を抽出(basic_formかsurface_formに単語が存在する)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span>basic_form <span class=\"token operator\">===</span> <span class=\"token constant\">NO_CONTENT</span> <span class=\"token operator\">?</span> t<span class=\"token punctuation\">.</span>surface_form <span class=\"token operator\">:</span> t<span class=\"token punctuation\">.</span>basic_form<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// [{text: 単語, value: 出現回数}]の形にReduce</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c<span class=\"token punctuation\">.</span>text <span class=\"token operator\">===</span> text<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            target<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>value <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              text<span class=\"token punctuation\">,</span>\n              <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword\">return</span> data\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      \n      <span class=\"token comment\">// 加工した解析結果をstateにセット</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>dataForD3Cloud<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 略</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<h3 id=\"2-データをもとにイイ感じの画像出力-1\" style=\"position:relative;\"><a href=\"#2-%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%82%E3%81%A8%E3%81%AB%E3%82%A4%E3%82%A4%E6%84%9F%E3%81%98%E3%81%AE%E7%94%BB%E5%83%8F%E5%87%BA%E5%8A%9B-1\" aria-label=\"2 データをもとにイイ感じの画像出力 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. データをもとにイイ感じの画像出力</h3>\n<p><a href=\"https://github.com/Yoctol/react-d3-cloud\">react-d3-cloud</a>が専用のコンポーネントを提供しているのでそれを使うだけです。</p>\n<div class=\"gatsby-code-title\">WordCloud描画処理</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> WordCloud <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-d3-cloud\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// フォントの大きさを決める関数</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fontSizeMapper</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">word</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span>\n\n<span class=\"token comment\">// フォントの回転位置</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">rotate</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">word</span> <span class=\"token operator\">=></span> word<span class=\"token punctuation\">.</span>value <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> <span class=\"token number\">90</span>\n\n<span class=\"token comment\">// フォントの種類</span>\n<span class=\"token keyword\">const</span> fontFamily <span class=\"token operator\">=</span> <span class=\"token string\">'meiryo'</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 略</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentWillMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 略</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"App\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>WordCloud\n          data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>dataForD3Cloud<span class=\"token punctuation\">}</span>\n          fontSizeMapper<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>fontSizeMapper<span class=\"token punctuation\">}</span>\n          rotate<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>rotate<span class=\"token punctuation\">}</span>\n          font<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>fontFamily<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>さて、ここで疑問を持たれる方もいると思います。\n前述の<a href=\"#2-%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%82%E3%81%A8%E3%81%AB%E3%82%A4%E3%82%A4%E6%84%9F%E3%81%98%E3%81%AE%E7%94%BB%E5%83%8F%E5%87%BA%E5%8A%9B\">WordCloudの作り方（原理）> 2. データをもとにイイ感じの画像出力</a>で画像出力するには以下を決定する必要があると述べました。</p>\n<ol>\n<li>フォントの大きさ・・・・・☚コンポーネントで定義した👍</li>\n<li>フォントの回転位置・・・・☚コンポーネントで定義した👍</li>\n<li>フォントの種類・・・・・・☚コンポーネントで定義した👍</li>\n<li>フォントの色・・・・・・・☚コンポーネントで定義してない🤔</li>\n<li>表示位置・・・・・・・・・☚コンポーネントで定義してない🤔</li>\n</ol>\n<p><code class=\"language-text\">4</code>,<code class=\"language-text\">5</code>どうやって決めるのでしょうか？\n実は<code class=\"language-text\">4</code>はreact-d3-cloud内部でよしなり定義してくれていて、\n<code class=\"language-text\">5</code>はD3-Cloudがイイ感じに決めてくれています。</p>\n<p><a href=\"https://github.com/Yoctol/react-d3-cloud/blob/master/src/WordCloud.js#L91\"><strong>↓react-d3-cloud内部ロジック 色定義：WordCloud.js#L91</strong></a></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 67\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">   <span class=\"token keyword\">const</span> layout <span class=\"token operator\">=</span> <span class=\"token function\">cloud</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">font</span><span class=\"token punctuation\">(</span>font<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">words</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">padding</span><span class=\"token punctuation\">(</span>padding<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">rotate</span><span class=\"token punctuation\">(</span>rotate<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">fontSize</span><span class=\"token punctuation\">(</span>fontSizeMapper<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">words</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> texts <span class=\"token operator\">=</span> <span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>wordCloud<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'svg'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">,</span> layout<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">,</span> layout<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'g'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">'transform'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>layout<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>layout<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span>\n          <span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>words<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">'font-size'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">d</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>d<span class=\"token punctuation\">.</span>size<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">'font-family'</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">          <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fill'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fill</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span>          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text-anchor'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'middle'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transform'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">d</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">[</span>d<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)rotate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>d<span class=\"token punctuation\">.</span>rotate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">d</span> <span class=\"token operator\">=></span> d<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p><a href=\"https://github.com/jasondavies/d3-cloud/blob/master/build/d3.layout.cloud.js#L59-L73\"><strong>↓D3-Cloud内部ロジック 表示位置定義：d3.layout.cloud.js#L59-L73</strong></a></p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber 56\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">    <span class=\"token keyword\">function</span> <span class=\"token function\">step</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> start <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start <span class=\"token operator\">&lt;</span> timeInterval <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">++</span>i <span class=\"token operator\">&lt;</span> n <span class=\"token operator\">&amp;&amp;</span> timer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        d<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        d<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">cloudSprite</span><span class=\"token punctuation\">(</span>contextAndRatio<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">.</span>hasText <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">place</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">,</span> bounds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          tags<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token function\">event</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"word\"</span><span class=\"token punctuation\">,</span> cloud<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bounds<span class=\"token punctuation\">)</span> <span class=\"token function\">cloudBounds</span><span class=\"token punctuation\">(</span>bounds<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token keyword\">else</span> bounds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> d<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> d<span class=\"token punctuation\">.</span>x0<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> d<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+</span> d<span class=\"token punctuation\">.</span>y0<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> d<span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> d<span class=\"token punctuation\">.</span>x1<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> d<span class=\"token punctuation\">.</span>y <span class=\"token operator\">+</span> d<span class=\"token punctuation\">.</span>y1<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token comment\">// Temporary hack</span></span><span class=\"gatsby-highlight-code-line\">          d<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-=</span> size<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">          d<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-=</span> size<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span></span>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">>=</span> n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        cloud<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">event</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end\"</span><span class=\"token punctuation\">,</span> cloud<span class=\"token punctuation\">,</span> tags<span class=\"token punctuation\">,</span> bounds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n<p>これによって以下のようなイイ感じのWordCloudを出力することができるのですね。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/76191097103de55829c825fc63f9828a/748b0/wordcloud-sample.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAENElEQVR42kWS624aZwJAedl9kNXuj0p7UdTLrrorbXerNm0um5hkEjtxHGzHEAzmAzw2twGGuQ9zgYEBhst8PlXVH32BI52jU1DV1lcj3epNG29v1lf/FaPRG2G4FRHexWI28sSbW0s8/dQVP37qCuvOEd26JxqfHRENZ8Ib+0KLI9Hzw5uWF/QajcajgmHqypyULNZy4j6rrEW+6ZH5GotsTa07oTxZUjXWZMuQ3OySGWOw75GLDHu+5zjd5G+2MHKcYkGf6K8yEppmtH/d8uV0tpBc/0duP34hN+0nkvI3cq9dyMDey4XWlQf9WnL1SB4u/yYtN5XGXSjb6/W+lO4xbPtlYawbSnIAMZnl35fHdMIMaV3Dsz+QGg6Zcc9D8xlTD9Ig4VD7gYf3f+bQVfA0nZu7iNNZkncOoFtWsaCPB8phmzL3zTx0l0zjDXz8E/LiW1YRyPsy2/4R8zSA1lMeescs5zEbZ8ju7d8piYB/RfP8+WLHyLSKhYFhKqx06Cr5pjlD2iYPNz8ga09YBrBVzzlUvmQXD8CoQflrHkp/Zd8scij/D7Nj0Rkbubt/wHLdYsG2HQVW5EGUr7SE7Sjl4CRgtgmGDk+vNaR2xso3WfgWmVCQv2qrL5m/KpKefsB7+yzHC5jUh8WCaZoK7Jj7Tj4xbQLTpl+tcFep4N0JXjddfrwJSOczVvOIXesW2b5mmy1IL0tsHYefwtPcywK85qRYsF1X4SBZW3a+negsfJ/edZlho0bzwzGLqcl5x+SPRyr/LvV5fNrntl4Dq0rut9mvFljtcs56xcT0igVT0xTSBdHUz23TxxxPGIk6ekvQrVyxXfm8V3X+8rbPu7bJS7X9ayuCB5g7Dqt370gqtXxu6KiiXiwYuq64C4kX+3k4V0nmNlq1QvtTCa9X53l9wk9VCysdUHXO+e72W150n6JGY9SpSmN4zj5K8kOSMLhVi4WxriuTJehOLV8uq0ytK4aNOoPrCvdC8N2lxmIW4I6GHA+Oed75PyeTDzQHFzitGqo7Jj15l3PfQdcnxYJj2wpAuJrl0fIOyyij1auoF2fcHCtMgym98YhZEiPcBo/bj3k9OkEML0lOzhF+Rvzieb6tVKi3mr8D+zM3PzNP6Rq3DD5fcfvxBLVySaLrZNqIj/oZyvANxf4RT+5/5kR/D2qf2dEL0vOLXG42lPq/bfNKAk4a7Rt+Qw5DTTqDoex+FnIWRHL54UzG//in1HqqrHSqsj9syWb3s2z6ujwK13JomjK0f96vWfBp5L0sOE6kQMAu6+W2NSXwbXbpDl/bsl9twbFhFrNZpiyTlF264iGJSTcrqpnE3e85bNQcNqiTXrFw31a/SmKrF3rmjTkciVG3I1xjIjzPFaHjiNgwRZLEYjENhR/FIg5nIg0dETlj4TmuiD1HRNPZjakPeqVG6dEvx/OxlPZOgfsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/76191097103de55829c825fc63f9828a/ba381/wordcloud-sample.webp 200w,\n/static/76191097103de55829c825fc63f9828a/7f61c/wordcloud-sample.webp 400w,\n/static/76191097103de55829c825fc63f9828a/d00b9/wordcloud-sample.webp 800w,\n/static/76191097103de55829c825fc63f9828a/1ae05/wordcloud-sample.webp 868w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/76191097103de55829c825fc63f9828a/772e8/wordcloud-sample.png 200w,\n/static/76191097103de55829c825fc63f9828a/e17e5/wordcloud-sample.png 400w,\n/static/76191097103de55829c825fc63f9828a/5a190/wordcloud-sample.png 800w,\n/static/76191097103de55829c825fc63f9828a/748b0/wordcloud-sample.png 868w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/76191097103de55829c825fc63f9828a/5a190/wordcloud-sample.png\"\n            alt=\"wordcloud sample\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"その他日本語長文サンプルの準備にはすぐに使えるダミーテキストが便利\" style=\"position:relative;\"><a href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E6%97%A5%E6%9C%AC%E8%AA%9E%E9%95%B7%E6%96%87%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AE%E6%BA%96%E5%82%99%E3%81%AB%E3%81%AF%E3%81%99%E3%81%90%E3%81%AB%E4%BD%BF%E3%81%88%E3%82%8B%E3%83%80%E3%83%9F%E3%83%BC%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%8C%E4%BE%BF%E5%88%A9\" aria-label=\"その他日本語長文サンプルの準備にはすぐに使えるダミーテキストが便利 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>その他：日本語長文サンプルの準備には「すぐに使えるダミーテキスト」が便利</h2>\n<p>WordCloudを作るときにテキトーな日本語文章を大量に用意する必要があります。\nそんな時は下記サイトが便利でした。</p>\n<p><a href=\"https://lipsum.sugutsukaeru.jp/index.cgi\">https://lipsum.sugutsukaeru.jp/index.cgi</a></p>\n<h2 id=\"まとめ\" style=\"position:relative;\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-label=\"まとめ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Pythonじゃないと形態素解析とWordCloud生成は無理かなと思っていましたが、JavaScriptでもライブラリが提供されていました。JavaScriptであればブラウザ上で処理を行えるので、たとえば入力フォームに入力した文字列をインプットにWordCloudを生成するなど、インタラクティブな操作が可能です。ただし生成に時間がかかるので、実際使うときはユーザーに生成中の旨をフィードバックするようなUIにする必要があるでしょう🍅</p>","excerpt":"なにこれ WordCloudをJSだけで生成したい。Pythonとか使わずにフロントエンドだけでやりたい。というモチベーションで、\nkuromoji.jsとD3-Cloudを使って文字列をインプットにWordCloudを描画するReact…","frontmatter":{"slug":"/wordcloud-with-kuromoji-d3cloud-react","title":"React + kuromoji.js + D3-CloudでWordCloudをブラウザに描画","date":"2019-05-04T12:40:00.000+09:00","tags":["React","kuromoji.js","d3.js","d3Cloud","データ可視化","形態素解析","WordCloud"],"keywords":["React"],"thumbnail":"thumbnail/2019/05/wordcloud-with-kuromoji-d3cloud-react.png","category":null}}}},"staticQueryHashes":["3868140423","4185443638","467257065","558103266"],"slicesMap":{}}